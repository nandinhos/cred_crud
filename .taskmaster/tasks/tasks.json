{
  "master": {
    "tasks": [
      {
        "id": "1",
        "title": "FASE 1: Documentação Centralizada e Completa",
        "description": "Consolidar e atualizar toda documentação do projeto em arquivos centralizados (README.md, CLAUDE.md, database_schema.md, best-practices) garantindo alinhamento com Laravel 12 e Filament 4.",
        "details": "1. **Atualizar README.md com Informações Completas**:\n   - Adicionar badges de versão (Laravel 12, Filament 4, PHP 8.3)\n   - Documentar stack tecnológico completo\n   - Incluir seção de Quick Start com comandos Sail\n   - Adicionar troubleshooting comum\n\n2. **Revisar e Expandir CLAUDE.md**:\n   - Documentar padrões Filament 4 específicos (Schemas vs Forms)\n   - Adicionar exemplos de code patterns do projeto\n   - Documentar namespaces corretos (Filament\\Actions vs Tables\\Actions)\n   - Incluir convenções de commits e testes\n\n3. **Gerar/Atualizar database_schema.md**:\n   ```bash\n   vendor/bin/sail artisan schema:dump --prune\n   ```\n   - Documentar todas as tabelas, colunas e tipos\n   - Documentar relacionamentos e foreign keys\n   - Incluir diagrama ER (mermaid)\n\n4. **Consolidar best-practices-laravel12-filament4.md**:\n   - Padrões de Resource Structure\n   - Patterns de autorização (Policy vs canAccess)\n   - Convenções de teste com Pest\n   - Patterns de Factories e Seeders\n\n5. **Documentar Lessons Learned**:\n   - Atualizar `.taskmaster/docs/lessons-learned.md`\n   - Adicionar problemas encontrados e soluções\n   - Documentar gotchas do Filament 4",
        "testStrategy": "1. **Validação de Completude**:\n   - Verificar que README contém: instalação, setup, comandos principais\n   - Confirmar CLAUDE.md tem seção de Filament 4 patterns\n   - Validar database_schema.md está atualizado com schema atual\n\n2. **Teste de Usabilidade**:\n   - Seguir instruções do README em ambiente limpo\n   - Confirmar que links internos funcionam\n   - Verificar exemplos de código são executáveis\n\n3. **Verificação de Consistência**:\n   ```bash\n   grep -r \"Filament\\\\Forms\\\\Form\" . --include=\"*.md\"\n   ```\n   - Não deve retornar resultados (namespace obsoleto)\n   - Documentação deve usar Filament\\Schemas\\Schema\n\n4. **Peer Review**:\n   - Solicitar revisão de outro desenvolvedor\n   - Confirmar clareza e ausência de ambiguidades",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "complexity": 2,
        "recommendedSubtasks": 5,
        "expansionPrompt": "Dividir a tarefa de documentação em subtasks específicas: (1) Atualizar README.md com badges, stack tecnológico e Quick Start; (2) Revisar CLAUDE.md com padrões Filament 4 e namespaces corretos; (3) Gerar database_schema.md atualizado com diagrama ER; (4) Consolidar best-practices-laravel12-filament4.md; (5) Documentar lessons learned com problemas e soluções encontradas.",
        "updatedAt": "2025-11-21T01:32:04.596Z",
        "subtasks": [
          {
            "id": 1,
            "title": "Atualizar README.md com badges, stack tecnológico e Quick Start",
            "description": "Adicionar badges de versão (Laravel 12, Filament 4, PHP 8.3), documentar stack tecnológico completo, incluir seção de Quick Start com comandos Sail e adicionar troubleshooting comum",
            "dependencies": [],
            "details": "Editar README.md para incluir: (1) Badges do shields.io mostrando Laravel 12.39.0, Filament 4.2.2, PHP 8.3+, MySQL 8.0; (2) Seção Technology Stack listando Laravel, Filament, Livewire, Alpine.js, TailwindCSS, Pest, Spatie Permission; (3) Seção Quick Start com comandos: git clone, cp .env.example .env, vendor/bin/sail up -d, sail artisan migrate --seed, acesso em http://localhost/admin; (4) Seção Troubleshooting com problemas comuns: Vite manifest not found, 403 Forbidden, permissões não funcionando",
            "status": "done",
            "testStrategy": "Validar que README.md contém todos os elementos: verificar presença de badges no topo, confirmar seção Technology Stack está completa, testar comandos Quick Start em ambiente limpo, verificar que troubleshooting cobre os 3 problemas principais documentados em lessons-learned.md",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T00:03:00.445Z"
          },
          {
            "id": 2,
            "title": "Revisar e expandir CLAUDE.md com padrões Filament 4 e namespaces corretos",
            "description": "Documentar padrões Filament 4 específicos (Schemas vs Forms), adicionar exemplos de code patterns do projeto, documentar namespaces corretos (Filament\\Actions vs Tables\\Actions) e incluir convenções de commits e testes",
            "dependencies": [],
            "details": "Atualizar CLAUDE.md com: (1) Seção 'Filament 4 Specific Patterns' mostrando uso correto de Filament\\Schemas\\Schema em vez de Forms\\Form; (2) Exemplos de namespaces: use Filament\\Actions\\Action, use Filament\\Actions\\EditAction (CORRETO) vs use Filament\\Tables\\Actions\\EditAction (INCORRETO); (3) Code patterns de Resource Structure mostrando estrutura de pastas (Pages/, Schemas/, Tables/); (4) Seção 'Important Conventions' com convenções de commit em português usando Conventional Commits; (5) Padrões de teste com Pest PHP incluindo exemplos do projeto",
            "status": "done",
            "testStrategy": "Revisar CLAUDE.md para confirmar: seção Filament 4 Patterns existe e mostra diferença Schema vs Form, namespaces corretos estão documentados com exemplos ✅ e ❌, estrutura de Resource está documentada, convenções de commit estão em português, exemplos de teste Pest estão presentes",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T00:19:58.770Z"
          },
          {
            "id": 3,
            "title": "Gerar database_schema.md atualizado com diagrama ER",
            "description": "Executar comando artisan schema:dump, documentar todas as tabelas, colunas e tipos, documentar relacionamentos e foreign keys, e incluir diagrama ER em formato mermaid",
            "dependencies": [],
            "details": "Executar: vendor/bin/sail artisan schema:dump --prune para gerar schema atualizado. Criar/atualizar .taskmaster/docs/database_schema.md com: (1) Listagem de todas as tabelas: users, credentials, roles, permissions, model_has_roles, model_has_permissions, activity_logs; (2) Para cada tabela documentar colunas, tipos, nullable, defaults, índices; (3) Documentar relacionamentos: User hasMany Credential (ON DELETE SET NULL), User belongsToMany Role, User belongsToMany Permission; (4) Criar diagrama ER usando sintaxe mermaid.js mostrando entidades e relacionamentos principais",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan schema:dump e comparar output com database_schema.md. Verificar que todas as tabelas do dump estão documentadas. Validar diagrama mermaid renderiza corretamente copiando código para https://mermaid.live. Confirmar relacionamentos documentados batem com foreign keys no schema dump",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T01:30:52.838Z"
          },
          {
            "id": 4,
            "title": "Consolidar best-practices-laravel12-filament4.md com padrões do projeto",
            "description": "Documentar padrões de Resource Structure, patterns de autorização (Policy vs canAccess), convenções de teste com Pest e patterns de Factories e Seeders baseados no código atual do projeto",
            "dependencies": [
              1,
              2
            ],
            "details": "Criar/atualizar .taskmaster/docs/best-practices-laravel12-filament4.md com: (1) Seção 'Resource Structure' mostrando organização app/Filament/Resources/EntityResource.php + Entity/Pages/ + Entity/Schemas/ + Entity/Tables/; (2) Seção 'Authorization Patterns' documentando canAccessPanel() no Model vs canAccess()/canCreate()/canEdit() no Resource, com exemplos do CredentialResource e UserResource; (3) Seção 'Testing with Pest' mostrando padrões: use de factories, it() syntax, actingAs() para autenticação, assertions Livewire; (4) Seção 'Factories and Seeders' com patterns de states, sequences e relacionamentos baseados em UserFactory e DatabaseSeeder do projeto",
            "status": "done",
            "testStrategy": "Revisar best-practices-laravel12-filament4.md confirmando: possui seção Resource Structure com exemplo de estrutura de pastas, possui seção Authorization Patterns com diferença Model vs Resource, possui seção Testing mostrando syntax Pest com it(), possui seção Factories com exemplos de states. Validar que exemplos de código são extraídos do projeto real (CredentialResource.php, UserResource.php, RoleAuthorizationTest.php)",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T01:31:33.140Z"
          },
          {
            "id": 5,
            "title": "Documentar lessons learned com problemas e soluções encontradas",
            "description": "Atualizar .taskmaster/docs/lessons-learned.md adicionando problemas encontrados durante desenvolvimento, soluções aplicadas e gotchas específicos do Filament 4",
            "dependencies": [
              1,
              2,
              3,
              4
            ],
            "details": "Atualizar .taskmaster/docs/lessons-learned.md com: (1) Seção 'Known Issues & Solutions' documentando: Vite manifest not found (solução: npm install && npm run build), 403 Forbidden em /admin (solução: usar /login-admin ou verificar canAccessPanel()), EditAction button não visível (solução: usar Filament\\Actions\\Action customizado), Permissions not working (solução: verificar roles e reseed); (2) Seção 'Filament 4 Gotchas' documentando: namespace changes (Actions vs Tables\\Actions), Schema vs Form, estrutura de Resources com subpastas; (3) Seção 'Laravel 12 Structure' documentando decisão de manter estrutura Laravel 10 (Kernel.php, Middleware em app/Http); (4) Adicionar data e contexto para cada lesson learned",
            "status": "done",
            "testStrategy": "Revisar lessons-learned.md confirmando: possui pelo menos 4 problemas documentados com soluções, possui seção Filament 4 Gotchas com namespaces, possui seção Laravel 12 Structure explicando estrutura híbrida, cada item possui contexto claro do problema e solução aplicada. Validar que soluções batem com código atual do projeto (verificar User.php para canAccessPanel, verificar CredentialResource.php para Actions)",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T01:32:04.596Z"
          }
        ]
      },
      {
        "id": "2",
        "title": "FASE 2: Models e Eloquent - Type Safety e Factories Completas",
        "description": "Modernizar Models com type hints completos (HasMany, BelongsTo), PHPDoc, método casts(), criar factories com states avançados para testes, implementar sistema de auditoria com Observer e externalizar email hardcoded para configuração.",
        "details": "1. **Adicionar Type Hints e PHPDoc nos Models**:\n\n   Atualizar `app/Models/User.php`:\n   ```php\n   use Illuminate\\Database\\Eloquent\\Relations\\HasMany;\n   use Illuminate\\Database\\Eloquent\\Relations\\BelongsToMany;\n   \n   /**\n    * @property int $id\n    * @property string $name\n    * @property string $email\n    * @property \\Illuminate\\Support\\Carbon $created_at\n    * @property \\Illuminate\\Support\\Carbon $updated_at\n    */\n   class User extends Authenticatable\n   {\n       /** @return HasMany<Credential> */\n       public function credentials(): HasMany\n       {\n           return $this->hasMany(Credential::class);\n       }\n       \n       /** @return BelongsToMany<Role> */\n       public function roles(): BelongsToMany\n       {\n           return $this->belongsToMany(Role::class);\n       }\n   }\n   ```\n\n   Atualizar `app/Models/Credential.php`:\n   ```php\n   use Illuminate\\Database\\Eloquent\\Relations\\BelongsTo;\n   \n   /**\n    * @property int $id\n    * @property string $fscs\n    * @property string $name\n    * @property string $secrecy\n    * @property \\Illuminate\\Support\\Carbon $validity\n    * @property int|null $user_id\n    */\n   class Credential extends Model\n   {\n       /** @return BelongsTo<User, Credential> */\n       public function user(): BelongsTo\n       {\n           return $this->belongsTo(User::class);\n       }\n       \n       protected function casts(): array\n       {\n           return [\n               'validity' => 'date',\n               'created_at' => 'datetime',\n               'updated_at' => 'datetime',\n               'deleted_at' => 'datetime',\n           ];\n       }\n   }\n   ```\n\n2. **Criar Factories Completas com States**:\n\n   Atualizar `database/factories/CredentialFactory.php`:\n   ```php\n   public function definition(): array\n   {\n       return [\n           'fscs' => 'FSCS-' . $this->faker->unique()->numberBetween(1000, 9999),\n           'name' => $this->faker->company(),\n           'secrecy' => $this->faker->randomElement(['R', 'S']),\n           'validity' => $this->faker->dateTimeBetween('+1 month', '+2 years'),\n           'user_id' => User::factory(),\n       ];\n   }\n   \n   public function expired(): static\n   {\n       return $this->state(fn (array $attributes) => [\n           'validity' => now()->subDays(rand(1, 365)),\n       ]);\n   }\n   \n   public function expiringSoon(): static\n   {\n       return $this->state(fn (array $attributes) => [\n           'validity' => now()->addDays(rand(1, 30)),\n       ]);\n   }\n   \n   public function reserved(): static\n   {\n       return $this->state(fn (array $attributes) => [\n           'secrecy' => 'R',\n       ]);\n   }\n   \n   public function secret(): static\n   {\n       return $this->state(fn (array $attributes) => [\n           'secrecy' => 'S',\n       ]);\n   }\n   ```\n\n   Atualizar `database/factories/UserFactory.php`:\n   ```php\n   public function withRole(string $role): static\n   {\n       return $this->afterCreating(function (User $user) use ($role) {\n           $user->assignRole($role);\n       });\n   }\n   \n   public function superAdmin(): static\n   {\n       return $this->withRole('super_admin');\n   }\n   \n   public function admin(): static\n   {\n       return $this->withRole('admin');\n   }\n   \n   public function consulta(): static\n   {\n       return $this->withRole('consulta');\n   }\n   ```\n\n3. **Implementar Observer para Activity Log**:\n\n   Criar `app/Observers/CredentialObserver.php`:\n   ```php\n   namespace App\\Observers;\n   \n   use App\\Models\\Credential;\n   use Illuminate\\Support\\Facades\\Auth;\n   use Illuminate\\Support\\Facades\\DB;\n   \n   class CredentialObserver\n   {\n       public function created(Credential $credential): void\n       {\n           $this->logActivity('created', $credential);\n       }\n       \n       public function updated(Credential $credential): void\n       {\n           $this->logActivity('updated', $credential, [\n               'changes' => $credential->getChanges(),\n           ]);\n       }\n       \n       public function deleted(Credential $credential): void\n       {\n           $this->logActivity('deleted', $credential);\n       }\n       \n       private function logActivity(string $action, Credential $credential, array $extra = []): void\n       {\n           DB::table('activity_logs')->insert([\n               'model_type' => Credential::class,\n               'model_id' => $credential->id,\n               'action' => $action,\n               'user_id' => Auth::id(),\n               'changes' => json_encode($extra),\n               'created_at' => now(),\n           ]);\n       }\n   }\n   ```\n\n   Registrar no `AppServiceProvider`:\n   ```php\n   use App\\Models\\Credential;\n   use App\\Observers\\CredentialObserver;\n   \n   public function boot(): void\n   {\n       Credential::observe(CredentialObserver::class);\n   }\n   ```\n\n4. **Externalizar Email Hardcoded**:\n\n   Adicionar em `config/auth.php`:\n   ```php\n   'super_admin_email' => env('SUPER_ADMIN_EMAIL', 'admin@admin.com'),\n   ```\n\n   Atualizar `app/Models/User.php`:\n   ```php\n   public function canAccessPanel(Panel $panel): bool\n   {\n       if ($this->email === config('auth.super_admin_email')) {\n           return true;\n       }\n       return $this->hasRole(['super_admin', 'admin', 'consulta']);\n   }\n   ```\n\n   Adicionar no `.env.example`:\n   ```\n   SUPER_ADMIN_EMAIL=admin@admin.com\n   ```",
        "testStrategy": "1. **Testes de Type Hints e PHPDoc**:\n   ```bash\n   vendor/bin/sail composer require --dev phpstan/phpstan\n   vendor/bin/sail bin phpstan analyse app/Models\n   ```\n   - Verificar que PHPStan não reporta erros de tipagem nos Models\n   - Executar `php artisan tinker` e testar autocompletion das relações\n\n2. **Testes de Factories com States**:\n   ```bash\n   vendor/bin/sail artisan tinker\n   ```\n   ```php\n   use App\\Models\\Credential;\n   $expired = Credential::factory()->expired()->create();\n   $expiring = Credential::factory()->expiringSoon()->create();\n   $reserved = Credential::factory()->reserved()->secret()->create(); // Deve falhar\n   ```\n\n3. **Testes do Observer**:\n   ```bash\n   vendor/bin/sail artisan tinker\n   ```\n   ```php\n   $user = User::factory()->create();\n   Auth::login($user);\n   $cred = Credential::factory()->create();\n   // Verificar: DB::table('activity_logs')->latest()->first();\n   ```\n\n4. **Teste de Configuração Externa**:\n   ```bash\n   vendor/bin/sail artisan tinker --execute=\"echo config('auth.super_admin_email');\"\n   ```\n   - Deve retornar email do .env\n   - Alterar .env e verificar que muda\n\n5. **Teste de Casts**:\n   ```php\n   $cred = Credential::factory()->create();\n   dump($cred->validity); // Deve ser Carbon instance\n   ```",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "done",
        "complexity": 6,
        "recommendedSubtasks": 8,
        "expansionPrompt": "Decompor em subtasks: (1) Adicionar type hints e PHPDoc em User model; (2) Adicionar type hints e método casts() em Credential model; (3) Criar states avançados em CredentialFactory (expired, expiringSoon, reserved, secret); (4) Criar states de roles em UserFactory (superAdmin, admin, consulta); (5) Criar CredentialObserver para activity logging; (6) Registrar Observer no AppServiceProvider; (7) Externalizar email hardcoded para config/auth.php; (8) Atualizar .env.example e testar configuração.",
        "updatedAt": "2025-11-21T02:43:29.467Z",
        "subtasks": [
          {
            "id": 1,
            "title": "Adicionar type hints e PHPDoc completos no User model",
            "description": "Atualizar app/Models/User.php com type hints para relacionamentos (HasMany<Credential>, BelongsToMany<Role>) e adicionar PHPDoc annotations completas para todas as propriedades do modelo.",
            "dependencies": [],
            "details": "Importar Illuminate\\Database\\Eloquent\\Relations\\HasMany e BelongsToMany. Adicionar PHPDoc block com @property para id, name, email, created_at, updated_at. Adicionar return types /** @return HasMany<Credential> */ para método credentials() e /** @return BelongsToMany<Role> */ para método roles(). Garantir que todos os relacionamentos tenham tipagem explícita.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail composer require --dev phpstan/phpstan e vendor/bin/sail bin phpstan analyse app/Models/User.php para verificar que não há erros de tipagem. Testar no tinker que autocomplete funciona corretamente para $user->credentials e $user->roles.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:42:16.475Z"
          },
          {
            "id": 2,
            "title": "Adicionar type hints, PHPDoc e método casts() no Credential model",
            "description": "Atualizar app/Models/Credential.php com type hints para relacionamento BelongsTo, PHPDoc annotations completas e implementar método casts() para date casting adequado.",
            "dependencies": [],
            "details": "Importar Illuminate\\Database\\Eloquent\\Relations\\BelongsTo. Adicionar PHPDoc block com @property para id, fscs, name, secrecy, validity, user_id. Adicionar return type /** @return BelongsTo<User, Credential> */ para método user(). Implementar protected function casts(): array com casting para validity como date e timestamps como datetime.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail bin phpstan analyse app/Models/Credential.php. Testar no tinker que $credential->validity retorna Carbon instance e que $credential->user retorna User model com tipagem correta. Verificar que dates são formatadas corretamente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:42:18.919Z"
          },
          {
            "id": 3,
            "title": "Criar states avançados na CredentialFactory",
            "description": "Implementar states expired(), expiringSoon(), reserved() e secret() na database/factories/CredentialFactory.php para permitir geração de dados de teste em cenários específicos.",
            "dependencies": [],
            "details": "Atualizar método definition() com faker para gerar fscs único, name, secrecy aleatório e validity futura. Criar método expired() que retorna state com validity no passado (subDays). Criar expiringSoon() com validity entre 1-30 dias. Criar reserved() com secrecy='R' e secret() com secrecy='S'. Todos os methods devem retornar static.",
            "status": "done",
            "testStrategy": "Criar teste em tests/Unit/CredentialFactoryTest.php que verifica cada state: Credential::factory()->expired()->create() deve ter validity no passado, expiringSoon() entre 1-30 dias, reserved() com secrecy='R', secret() com secrecy='S'. Executar vendor/bin/sail artisan test --filter=CredentialFactoryTest.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:42:32.295Z"
          },
          {
            "id": 4,
            "title": "Criar states de roles na UserFactory",
            "description": "Implementar methods withRole(), superAdmin(), admin() e consulta() na database/factories/UserFactory.php para facilitar criação de usuários com roles específicos em testes.",
            "dependencies": [],
            "details": "Criar método withRole(string $role): static que usa afterCreating callback para chamar $user->assignRole($role). Criar métodos de conveniência superAdmin(), admin() e consulta() que chamam withRole() com a role apropriada. Garantir que roles são atribuídas após criação do usuário para evitar problemas com relacionamentos.",
            "status": "done",
            "testStrategy": "Criar teste em tests/Unit/UserFactoryTest.php que verifica: User::factory()->superAdmin()->create() tem role 'super_admin', admin() tem 'admin', consulta() tem 'consulta'. Verificar que $user->hasRole() retorna true para role correta. Executar vendor/bin/sail artisan test --filter=UserFactoryTest.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:42:34.402Z"
          },
          {
            "id": 5,
            "title": "Criar CredentialObserver para activity logging",
            "description": "Implementar app/Observers/CredentialObserver.php com métodos created(), updated() e deleted() que registram ações na tabela activity_logs com informações de usuário e mudanças.",
            "dependencies": [],
            "details": "Criar diretório app/Observers se não existir. Criar CredentialObserver.php com namespace App\\Observers. Implementar métodos created(), updated(), deleted() que chamam logActivity(). Criar método privado logActivity() que insere em DB::table('activity_logs') com campos model_type, model_id, action, user_id (Auth::id()), changes (json_encode), created_at. No método updated(), incluir $credential->getChanges() no array changes.",
            "status": "done",
            "testStrategy": "Criar teste em tests/Feature/CredentialObserverTest.php que verifica: ao criar credential, registro é inserido em activity_logs com action='created'; ao atualizar, action='updated' e changes contém modificações; ao deletar, action='deleted'. Usar actingAs() para simular usuário autenticado. Executar vendor/bin/sail artisan test --filter=CredentialObserverTest.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:42:54.468Z"
          },
          {
            "id": 6,
            "title": "Registrar CredentialObserver no AppServiceProvider",
            "description": "Atualizar app/Providers/AppServiceProvider.php para registrar o CredentialObserver no método boot(), garantindo que eventos do modelo sejam observados.",
            "dependencies": [
              5
            ],
            "details": "Abrir app/Providers/AppServiceProvider.php. Importar use App\\Models\\Credential e use App\\Observers\\CredentialObserver. No método boot(), adicionar Credential::observe(CredentialObserver::class). Verificar que boot() method existe, se não, criar. Garantir que observer é registrado antes de qualquer operação de banco de dados.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan tinker e criar/atualizar/deletar uma Credential. Verificar que registros são inseridos na tabela activity_logs com SELECT * FROM activity_logs ORDER BY created_at DESC LIMIT 5. Confirmar que user_id, action e changes estão corretos. Executar testes de CredentialObserver novamente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:42:56.962Z"
          },
          {
            "id": 7,
            "title": "Externalizar email hardcoded para config/auth.php",
            "description": "Adicionar configuração 'super_admin_email' em config/auth.php lendo de variável de ambiente SUPER_ADMIN_EMAIL e atualizar User model para usar config() ao invés de string hardcoded.",
            "dependencies": [],
            "details": "Abrir config/auth.php e adicionar chave 'super_admin_email' => env('SUPER_ADMIN_EMAIL', 'admin@admin.com') no array de configuração principal. Atualizar app/Models/User.php, no método canAccessPanel(), substituir if ($this->email === 'admin@admin.com') por if ($this->email === config('auth.super_admin_email')). Garantir que lógica permanece inalterada.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan config:clear para limpar cache. Testar no tinker que config('auth.super_admin_email') retorna 'admin@admin.com'. Criar usuário com email diferente e verificar que não tem acesso ao painel. Criar usuário com email admin@admin.com e verificar que canAccessPanel() retorna true.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:43:27.325Z"
          },
          {
            "id": 8,
            "title": "Atualizar .env.example e testar configuração completa",
            "description": "Adicionar SUPER_ADMIN_EMAIL=admin@admin.com no arquivo .env.example e executar bateria de testes completa para garantir que todas as mudanças da FASE 2 funcionam corretamente.",
            "dependencies": [
              1,
              2,
              3,
              4,
              5,
              6,
              7
            ],
            "details": "Abrir .env.example e adicionar linha SUPER_ADMIN_EMAIL=admin@admin.com na seção de configurações de autenticação. Executar vendor/bin/sail artisan config:clear e cache:clear. Rodar vendor/bin/sail artisan test para executar toda suíte de testes. Verificar que não há regressões. Testar manualmente criação de credential via Filament e verificar activity_logs.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test e confirmar que todos os testes passam. Executar vendor/bin/sail bin pint --dirty para verificar formatação. Testar fluxo completo: criar credential via interface Filament, editar, deletar, e verificar que activity_logs tem 3 registros correspondentes. Verificar que factories funcionam com User::factory()->admin()->has(Credential::factory()->expired()->count(3))->create().",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:43:29.467Z"
          }
        ]
      },
      {
        "id": "3",
        "title": "FASE 3: Otimização de Database com Índices e Completar Migrations",
        "description": "Criar migration add_indexes_to_credentials_table com índices estratégicos (fscs, validity, created_at, composite user_id+validity) e implementar métodos down() faltantes nas migrations para permitir rollback completo do banco de dados.",
        "details": "1. **Criar Migration de Índices para Credentials**:\n   ```bash\n   vendor/bin/sail artisan make:migration add_indexes_to_credentials_table\n   ```\n   ```php\n   <?php\n   use Illuminate\\Database\\Migrations\\Migration;\n   use Illuminate\\Database\\Schema\\Blueprint;\n   use Illuminate\\Support\\Facades\\Schema;\n\n   return new class extends Migration\n   {\n       public function up(): void\n       {\n           Schema::table('credentials', function (Blueprint $table) {\n               // Índice único para FSCS (já existe via unique(), mas garantir)\n               if (!Schema::hasColumn('credentials', 'fscs')) {\n                   $table->unique('fscs', 'credentials_fscs_unique');\n               }\n               \n               // Índice para filtros por validity (queries de expiração)\n               $table->index('validity', 'credentials_validity_index');\n               \n               // Índice para ordenação por created_at\n               $table->index('created_at', 'credentials_created_at_index');\n               \n               // Índice composto para queries de credenciais por usuário e validade\n               $table->index(['user_id', 'validity'], 'credentials_user_validity_index');\n               \n               // Índice para secrecy level (filtros)\n               $table->index('secrecy', 'credentials_secrecy_index');\n           });\n       }\n\n       public function down(): void\n       {\n           Schema::table('credentials', function (Blueprint $table) {\n               $table->dropIndex('credentials_validity_index');\n               $table->dropIndex('credentials_created_at_index');\n               $table->dropIndex('credentials_user_validity_index');\n               $table->dropIndex('credentials_secrecy_index');\n           });\n       }\n   };\n   ```\n\n2. **Completar Migration 2023_07_25_200512_alter_credentials2_table**:\n\n   Localizar arquivo `database/migrations/2023_07_25_200512_alter_credentials2_table.php` e adicionar método down():\n   ```php\n   public function down(): void\n   {\n       Schema::table('credentials', function (Blueprint $table) {\n           // Reverter alterações feitas no up()\n           // Exemplo: se up() adicionou coluna 'secrecy', remover:\n           if (Schema::hasColumn('credentials', 'secrecy')) {\n               $table->dropColumn('secrecy');\n           }\n           // Adicionar reversões conforme o que foi alterado no up()\n       });\n   }\n   ```\n\n3. **Completar Migration 2023_07_25_181600_add_deleted_at_to_credentials**:\n\n   Localizar e adicionar down():\n   ```php\n   public function down(): void\n   {\n       Schema::table('credentials', function (Blueprint $table) {\n           $table->dropSoftDeletes();\n       });\n   }\n   ```\n\n4. **Criar Índices para Tabela Users (se necessário)**:\n   ```bash\n   vendor/bin/sail artisan make:migration add_indexes_to_users_table\n   ```\n   ```php\n   public function up(): void\n   {\n       Schema::table('users', function (Blueprint $table) {\n           // Email já tem unique, mas garantir índice\n           $table->index('email', 'users_email_index');\n           $table->index('created_at', 'users_created_at_index');\n       });\n   }\n   \n   public function down(): void\n   {\n       Schema::table('users', function (Blueprint $table) {\n           $table->dropIndex('users_email_index');\n           $table->dropIndex('users_created_at_index');\n       });\n   }\n   ```\n\n5. **Testar Rollback Completo**:\n   ```bash\n   # Backup antes de testar\n   docker-compose exec laravel.test mysqldump -u sail -psail cred_crud > backup_before_rollback.sql\n   \n   # Testar rollback\n   vendor/bin/sail artisan migrate:rollback --step=1\n   \n   # Re-executar\n   vendor/bin/sail artisan migrate\n   ```\n\n6. **Documentar Índices Criados**:\n   Atualizar `.taskmaster/docs/database_schema.md` com seção de índices:\n   ```markdown\n   ## Índices Otimizados\n   \n   ### Tabela: credentials\n   - `credentials_fscs_unique` (UNIQUE): fscs\n   - `credentials_validity_index`: validity\n   - `credentials_created_at_index`: created_at\n   - `credentials_user_validity_index` (COMPOSITE): user_id, validity\n   - `credentials_secrecy_index`: secrecy\n   ```",
        "testStrategy": "1. **Teste de Criação de Índices**:\n   ```bash\n   vendor/bin/sail artisan migrate\n   vendor/bin/sail artisan tinker --execute=\"DB::select('SHOW INDEXES FROM credentials');\"\n   ```\n   - Verificar que índices foram criados: credentials_fscs_unique, credentials_validity_index, credentials_created_at_index, credentials_user_validity_index, credentials_secrecy_index\n\n2. **Teste de Performance de Queries**:\n   ```bash\n   vendor/bin/sail artisan tinker\n   ```\n   ```php\n   // Criar 10.000 registros de teste\n   Credential::factory()->count(10000)->create();\n   \n   // Query SEM índice (antes): EXPLAIN\n   DB::select('EXPLAIN SELECT * FROM credentials WHERE validity > NOW()');\n   \n   // Query COM índice (depois): deve usar credentials_validity_index\n   // Verificar 'key' na saída do EXPLAIN\n   ```\n\n3. **Teste de Rollback Completo**:\n   ```bash\n   # Rollback de todas as migrations\n   vendor/bin/sail artisan migrate:rollback --step=10\n   ```\n   - Não deve haver erros\n   - Banco deve estar limpo\n   - Re-executar migrate deve funcionar\n\n4. **Teste de Rollback Individual**:\n   ```bash\n   vendor/bin/sail artisan migrate:rollback --step=1\n   ```\n   - Verificar que índices foram removidos:\n   ```php\n   DB::select('SHOW INDEXES FROM credentials');\n   ```\n\n5. **Benchmark de Performance**:\n   ```bash\n   vendor/bin/sail artisan tinker\n   ```\n   ```php\n   // Com 10k registros\n   $start = microtime(true);\n   Credential::where('validity', '>', now())->get();\n   $time = microtime(true) - $start;\n   echo \"Query time: {$time}s\";\n   // Deve ser < 0.1s com índice\n   ```",
        "priority": "medium",
        "dependencies": [
          "1",
          "2"
        ],
        "status": "done",
        "complexity": 5,
        "recommendedSubtasks": 6,
        "expansionPrompt": "Dividir em: (1) Criar migration add_indexes_to_credentials_table com índices estratégicos (fscs, validity, created_at, composite user_id+validity, secrecy); (2) Implementar método down() completo para rollback de índices; (3) Analisar e completar down() da migration 2023_07_25_200512_alter_credentials2_table; (4) Completar down() da migration add_deleted_at_to_credentials; (5) Criar migration add_indexes_to_users_table se necessário; (6) Testar rollback completo e documentar índices criados.",
        "updatedAt": "2025-11-21T02:56:32.932Z",
        "subtasks": [
          {
            "id": 1,
            "title": "Criar migration add_indexes_to_credentials_table com índices estratégicos",
            "description": "Criar nova migration para adicionar índices otimizados na tabela credentials, incluindo índices simples (fscs, validity, created_at, secrecy) e índice composto (user_id, validity) para melhorar performance de queries de filtro e ordenação.",
            "dependencies": [],
            "details": "Executar 'vendor/bin/sail artisan make:migration add_indexes_to_credentials_table' e implementar método up() com Schema::table('credentials') adicionando índices: unique para fscs (se não existir), index para validity (queries de expiração), index para created_at (ordenação), index composto para user_id+validity (queries de credenciais por usuário), e index para secrecy (filtros por nível de sigilo). Verificar existência de índices antes de criar para evitar duplicação.",
            "status": "done",
            "testStrategy": "Executar 'vendor/bin/sail artisan migrate' e verificar criação dos índices com 'vendor/bin/sail artisan tinker --execute=\"DB::select('SHOW INDEXES FROM credentials');\"'. Confirmar presença de credentials_fscs_unique, credentials_validity_index, credentials_created_at_index, credentials_user_validity_index e credentials_secrecy_index.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:50:33.261Z"
          },
          {
            "id": 2,
            "title": "Implementar método down() completo para rollback de índices na migration de otimização",
            "description": "Adicionar método down() completo na migration add_indexes_to_credentials_table para permitir rollback seguro removendo todos os índices criados no método up(), garantindo reversibilidade da otimização de banco de dados.",
            "dependencies": [
              1
            ],
            "details": "No arquivo da migration criada na subtarefa anterior, implementar método down() usando Schema::table('credentials') com dropIndex() para cada índice criado: credentials_validity_index, credentials_created_at_index, credentials_user_validity_index e credentials_secrecy_index. Não remover credentials_fscs_unique pois pode ser índice existente da estrutura original da tabela.",
            "status": "done",
            "testStrategy": "Executar 'vendor/bin/sail artisan migrate:rollback --step=1' após rodar a migration, verificar com 'SHOW INDEXES FROM credentials' que índices foram removidos, e re-executar 'vendor/bin/sail artisan migrate' para confirmar que migration funciona em ambas direções sem erros.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:51:00.233Z"
          },
          {
            "id": 3,
            "title": "Analisar e completar método down() da migration alter_credentials2_table",
            "description": "Localizar migration 2023_07_25_200512_alter_credentials2_table, analisar alterações feitas no método up() e implementar método down() correspondente para reverter todas as modificações (colunas adicionadas, índices, alterações de tipo).",
            "dependencies": [],
            "details": "Ler arquivo database/migrations/2023_07_25_200512_alter_credentials2_table.php, identificar todas operações no up() (provavelmente adição de coluna secrecy ou outras alterações), e criar down() que reverte cada operação usando dropColumn(), dropIndex() ou reversões de alterType() conforme necessário. Usar Schema::hasColumn() para verificações de segurança antes de dropar.\n<info added on 2025-11-21T02:52:31.765Z>\n```json\n\"Confirmado, o arquivo de migration `2023_07_25_200512_alter_credentials2_table.php` está de fato ausente no repositório. A sua proposta de criar uma migration corretiva é a abordagem correta para resolver o problema.\\n\\nO novo plano de ação é:\\n1. Gerar uma nova migration com um nome descritivo, como `php artisan make:migration correct_down_for_alter_credentials2_table`.\\n2. No método `up()` desta nova migration, implementar a lógica que estaria no método `down()` ausente. Com base na análise do schema atual e no contexto da tarefa, isso provavelmente envolve a remoção da coluna `secrecy` da tabela `credentials`. Utilize `Schema::hasColumn('credentials', 'secrecy')` como verificação de segurança antes de executar `dropColumn('secrecy')`.\\n3. No método `down()` da nova migration, implementar a lógica reversa (ou seja, a adição da coluna `secrecy`), garantindo que esta migration corretiva seja, ela mesma, totalmente reversível.\"\n```\n</info added on 2025-11-21T02:52:31.765Z>",
            "status": "cancelled",
            "testStrategy": "Executar 'vendor/bin/sail artisan migrate:rollback' até essa migration, verificar que tabela credentials voltou ao estado anterior sem erros, inspecionar schema com 'vendor/bin/sail artisan tinker --execute=\"DB::select('DESCRIBE credentials');\"' e confirmar que alterações foram revertidas, então re-executar migrate.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:55:15.696Z"
          },
          {
            "id": 4,
            "title": "Completar método down() da migration add_deleted_at_to_credentials",
            "description": "Localizar migration 2023_07_25_181600_add_deleted_at_to_credentials e adicionar método down() que remove a coluna deleted_at usando dropSoftDeletes() para permitir rollback da funcionalidade de soft delete.",
            "dependencies": [],
            "details": "Editar arquivo database/migrations/2023_07_25_181600_add_deleted_at_to_credentials.php e implementar método down() com Schema::table('credentials', function (Blueprint $table) { $table->dropSoftDeletes(); }). Isso removerá a coluna deleted_at adicionada no up() que habilita soft deletes no model Credential.\n<info added on 2025-11-21T02:53:35.005Z>\n\"Confirmado. O arquivo da migration original está ausente. Será criada uma nova migration dedicada para o rollback, que usará o método dropSoftDeletes() em sua função up() para remover a coluna deleted_at da tabela credentials.\"\n</info added on 2025-11-21T02:53:35.005Z>",
            "status": "cancelled",
            "testStrategy": "Executar 'vendor/bin/sail artisan migrate:rollback' até essa migration, verificar com 'DESCRIBE credentials' que coluna deleted_at foi removida, confirmar que model Credential ainda funciona (sem soft delete), e re-executar 'vendor/bin/sail artisan migrate' para restaurar funcionalidade.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:55:17.518Z"
          },
          {
            "id": 5,
            "title": "Criar migration add_indexes_to_users_table para otimização de queries de usuários",
            "description": "Criar nova migration para adicionar índices na tabela users (email e created_at) caso ainda não existam, melhorando performance de autenticação e listagens ordenadas por data de criação.",
            "dependencies": [],
            "details": "Executar 'vendor/bin/sail artisan make:migration add_indexes_to_users_table' e implementar up() com Schema::table('users') adicionando index para email (users_email_index) e created_at (users_created_at_index). Implementar down() correspondente com dropIndex() para ambos índices. Verificar se índices já existem antes de criar para evitar duplicação, especialmente email que pode já ter unique constraint.",
            "status": "done",
            "testStrategy": "Executar migration e verificar índices criados com 'SHOW INDEXES FROM users'. Testar rollback com 'migrate:rollback --step=1' e confirmar remoção dos índices. Executar queries de teste como 'SELECT * FROM users WHERE email = \"test@test.com\"' e verificar uso de índice com EXPLAIN.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:50:35.931Z"
          },
          {
            "id": 6,
            "title": "Testar rollback completo de todas migrations e documentar índices criados",
            "description": "Realizar backup completo do banco de dados, executar testes de rollback de todas migrations modificadas/criadas, validar integridade dos dados após rollback/migrate, e atualizar documentação em database_schema.md com seção detalhada de todos índices otimizados.",
            "dependencies": [
              1,
              2,
              3,
              4,
              5
            ],
            "details": "Criar backup com 'docker-compose exec laravel.test mysqldump -u sail -psail cred_crud > backup_before_rollback_$(date +%Y%m%d_%H%M%S).sql'. Executar 'vendor/bin/sail artisan migrate:rollback --step=5' para testar todas novas migrations, verificar sem erros, e re-executar 'vendor/bin/sail artisan migrate'. Atualizar .taskmaster/docs/database_schema.md adicionando seção '## Índices Otimizados' documentando todos índices de credentials (fscs unique, validity, created_at, user_id+validity composite, secrecy) e users (email, created_at) com seus nomes e propósitos.",
            "status": "done",
            "testStrategy": "Verificar que backup foi criado e tem tamanho válido (> 0 bytes). Executar rollback completo sem erros SQL. Confirmar que 'git diff .taskmaster/docs/database_schema.md' mostra nova seção de índices. Executar suite de testes com 'vendor/bin/sail artisan test' para garantir que aplicação funciona corretamente após ciclo completo de migrate/rollback/migrate.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T02:56:31.224Z"
          }
        ]
      },
      {
        "id": "4",
        "title": "FASE 4: Filament 4 Modernização - Centralizar Lógica de Badges",
        "description": "Criar app/Enums/BadgeColor.php com enum para centralizar lógica de cores de badges, implementando métodos forRole() e forSecrecy() para eliminar código duplicado entre CredentialsTable e UsersTable.",
        "details": "1. **Criar Enum BadgeColor para Centralizar Lógica de Cores**:\n   ```bash\n   mkdir -p app/Enums\n   ```\n   \n   Criar `app/Enums/BadgeColor.php`:\n   ```php\n   <?php\n   namespace App\\Enums;\n\n   enum BadgeColor: string\n   {\n       case SUCCESS = 'success';\n       case WARNING = 'warning';\n       case DANGER = 'danger';\n       case INFO = 'info';\n       case PRIMARY = 'primary';\n       case SECONDARY = 'secondary';\n\n       /**\n        * Retorna a cor apropriada para uma role\n        * \n        * @param string|null $roleName\n        * @return self\n        */\n       public static function forRole(?string $roleName): self\n       {\n           return match($roleName) {\n               'super_admin' => self::DANGER,\n               'admin' => self::WARNING,\n               'operador' => self::INFO,\n               'consulta' => self::SUCCESS,\n               default => self::SECONDARY,\n           };\n       }\n\n       /**\n        * Retorna a cor apropriada para secrecy level\n        * \n        * @param string|null $secrecy\n        * @return self\n        */\n       public static function forSecrecy(?string $secrecy): self\n       {\n           return match($secrecy) {\n               'S' => self::DANGER,  // Secreto = vermelho\n               'R' => self::WARNING, // Reservado = amarelo\n               default => self::SECONDARY,\n           };\n       }\n\n       /**\n        * Retorna a cor para status de validade\n        * \n        * @param \\Carbon\\Carbon|null $validityDate\n        * @return self\n        */\n       public static function forValidity(?\\Carbon\\Carbon $validityDate): self\n       {\n           if (!$validityDate) {\n               return self::SECONDARY;\n           }\n\n           if ($validityDate->isPast()) {\n               return self::DANGER; // Expirado\n           }\n\n           if ($validityDate->diffInDays(now()) <= 30) {\n               return self::WARNING; // Expirando em breve\n           }\n\n           return self::SUCCESS; // Válido\n       }\n   }\n   ```\n\n2. **Refatorar CredentialsTable para Usar BadgeColor Enum**:\n\n   Editar `app/Filament/Resources/Credentials/Tables/CredentialsTable.php`:\n   ```php\n   use App\\Enums\\BadgeColor;\n   use Filament\\Tables\\Columns\\TextColumn;\n\n   public static function table(Table $table): Table\n   {\n       return $table\n           ->columns([\n               TextColumn::make('fscs')\n                   ->label('FSCS')\n                   ->searchable()\n                   ->sortable(),\n               \n               TextColumn::make('name')\n                   ->label('Nome')\n                   ->searchable()\n                   ->sortable(),\n               \n               TextColumn::make('secrecy')\n                   ->label('Sigilo')\n                   ->badge()\n                   ->color(fn ($record) => BadgeColor::forSecrecy($record->secrecy)->value)\n                   ->formatStateUsing(fn ($state) => $state === 'S' ? 'Secreto' : 'Reservado'),\n               \n               TextColumn::make('validity')\n                   ->label('Validade')\n                   ->date('d/m/Y')\n                   ->badge()\n                   ->color(fn ($record) => BadgeColor::forValidity($record->validity)->value)\n                   ->sortable(),\n               \n               TextColumn::make('user.name')\n                   ->label('Responsável')\n                   ->searchable()\n                   ->sortable(),\n           ]);\n   }\n   ```\n\n3. **Refatorar UsersTable para Usar BadgeColor Enum**:\n\n   Editar `app/Filament/Resources/UserResource/Tables/UsersTable.php`:\n   ```php\n   use App\\Enums\\BadgeColor;\n\n   TextColumn::make('roles.name')\n       ->label('Roles')\n       ->badge()\n       ->color(fn ($state) => BadgeColor::forRole($state)->value)\n       ->formatStateUsing(fn ($state) => ucfirst($state)),\n   ```\n\n4. **Adicionar Testes Unitários para BadgeColor Enum**:\n\n   Criar `tests/Unit/BadgeColorEnumTest.php`:\n   ```php\n   <?php\n   use App\\Enums\\BadgeColor;\n\n   it('retorna cor correta para super_admin role', function () {\n       expect(BadgeColor::forRole('super_admin'))->toBe(BadgeColor::DANGER);\n   });\n\n   it('retorna cor correta para secrecy S', function () {\n       expect(BadgeColor::forSecrecy('S'))->toBe(BadgeColor::DANGER);\n   });\n\n   it('retorna cor correta para secrecy R', function () {\n       expect(BadgeColor::forSecrecy('R'))->toBe(BadgeColor::WARNING);\n   });\n\n   it('retorna cor correta para credencial expirada', function () {\n       $expired = now()->subDays(10);\n       expect(BadgeColor::forValidity($expired))->toBe(BadgeColor::DANGER);\n   });\n\n   it('retorna cor correta para credencial expirando em breve', function () {\n       $expiring = now()->addDays(15);\n       expect(BadgeColor::forValidity($expiring))->toBe(BadgeColor::WARNING);\n   });\n\n   it('retorna cor correta para credencial válida', function () {\n       $valid = now()->addYear();\n       expect(BadgeColor::forValidity($valid))->toBe(BadgeColor::SUCCESS);\n   });\n   ```\n\n5. **Documentar Enum no CLAUDE.md**:\n   Adicionar seção:\n   ```markdown\n   ### Badge Color Centralization\n   \n   Use `App\\Enums\\BadgeColor` para cores de badges:\n   ```php\n   BadgeColor::forRole('super_admin') // DANGER\n   BadgeColor::forSecrecy('S')        // DANGER\n   BadgeColor::forValidity($date)     // SUCCESS/WARNING/DANGER\n   ```\n   ```",
        "testStrategy": "1. **Testes de Criação do Enum**:\n   ```bash\n   vendor/bin/sail artisan tinker --execute=\"echo class_exists('\\\\App\\\\Enums\\\\BadgeColor') ? 'OK' : 'ERRO';\"\n   ```\n   - Verificar que enum foi criado corretamente\n   - Testar métodos estáticos:\n   ```php\n   use App\\Enums\\BadgeColor;\n   echo BadgeColor::forRole('super_admin')->value; // 'danger'\n   ```\n\n2. **Testes Unitários do Enum**:\n   ```bash\n   vendor/bin/sail artisan test tests/Unit/BadgeColorEnumTest.php\n   ```\n   - Todos os testes devem passar\n   - Cobertura de 100% dos métodos do enum\n\n3. **Teste Visual no Painel Filament**:\n   - Acessar `/admin/credentials`\n   - Verificar badges de secrecy:\n     - 'S' (Secreto) = vermelho\n     - 'R' (Reservado) = amarelo\n   - Verificar badges de validity:\n     - Expiradas = vermelho\n     - Expirando (< 30 dias) = amarelo\n     - Válidas = verde\n   - Acessar `/admin/users`\n   - Verificar badges de roles com cores corretas\n\n4. **Teste de Refatoração (Code Search)**:\n   ```bash\n   # Não deve haver código duplicado de cores\n   grep -r \"'danger'\" app/Filament/Resources/ --include=\"*.php\"\n   grep -r \"'warning'\" app/Filament/Resources/ --include=\"*.php\"\n   ```\n   - Verificar que apenas referencia BadgeColor enum\n\n5. **Teste de Consistência**:\n   ```bash\n   vendor/bin/sail artisan tinker\n   ```\n   ```php\n   use App\\Enums\\BadgeColor;\n   use App\\Models\\Credential;\n   \n   $cred = Credential::factory()->secret()->expired()->create();\n   echo BadgeColor::forSecrecy($cred->secrecy)->value; // 'danger'\n   echo BadgeColor::forValidity($cred->validity)->value; // 'danger'\n   ```",
        "priority": "low",
        "dependencies": [
          "1",
          "2"
        ],
        "status": "done",
        "complexity": 3,
        "recommendedSubtasks": 5,
        "expansionPrompt": "Separar em: (1) Criar o enum BadgeColor com todos os cases e métodos estáticos (forRole, forSecrecy, forValidity); (2) Refatorar a classe CredentialsTable para usar os métodos do enum BadgeColor; (3) Refatorar a classe UsersTable para usar o método forRole do enum; (4) Implementar a suite de testes unitários para o enum BadgeColor, garantindo 100% de cobertura de seus métodos; (5) Adicionar a documentação de uso do enum no arquivo CLAUDE.md.",
        "updatedAt": "2025-11-21T19:55:15.526Z",
        "subtasks": [
          {
            "id": 1,
            "title": "Criar enum BadgeColor com cases e métodos estáticos",
            "description": "Criar arquivo app/Enums/BadgeColor.php com enum backed string contendo cases (SUCCESS, WARNING, DANGER, INFO, PRIMARY, SECONDARY) e métodos estáticos forRole(), forSecrecy() e forValidity() para centralizar lógica de cores de badges.",
            "dependencies": [],
            "details": "Criar diretório app/Enums e implementar enum BadgeColor: string com 6 cases de cores. Implementar método forRole() usando match para mapear roles (super_admin->DANGER, admin->WARNING, operador->INFO, consulta->SUCCESS, default->SECONDARY). Implementar método forSecrecy() para mapear S->DANGER e R->WARNING. Implementar método forValidity() recebendo Carbon date, verificando se é passado (DANGER), expirando em 30 dias (WARNING) ou válido (SUCCESS). Adicionar DocBlocks em todos os métodos.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan tinker --execute=\"echo class_exists('\\\\App\\\\Enums\\\\BadgeColor') ? 'OK' : 'ERRO';\" para verificar se enum foi criado. Testar métodos estáticos manualmente no tinker verificando retornos corretos para cada caso.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T19:42:36.142Z"
          },
          {
            "id": 2,
            "title": "Refatorar CredentialsTable para usar BadgeColor enum",
            "description": "Modificar app/Filament/Resources/Credentials/Tables/CredentialsTable.php para substituir lógica inline de cores por chamadas aos métodos BadgeColor::forSecrecy() e BadgeColor::forValidity().",
            "dependencies": [
              1
            ],
            "details": "Adicionar use App\\Enums\\BadgeColor no topo do arquivo. Na coluna secrecy, modificar o método color() para usar fn ($record) => BadgeColor::forSecrecy($record->secrecy)->value. Na coluna validity, modificar o método color() para usar fn ($record) => BadgeColor::forValidity($record->validity)->value. Remover qualquer lógica inline de match ou condicionais para cores que estava anteriormente no arquivo. Manter formatStateUsing e demais configurações intactas.",
            "status": "done",
            "testStrategy": "Acessar http://localhost/admin/credentials e verificar visualmente que os badges de Sigilo e Validade mantêm as mesmas cores de antes da refatoração. Testar com diferentes registros (S vs R, expirados vs válidos vs expirando).",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T19:43:10.866Z"
          },
          {
            "id": 3,
            "title": "Refatorar UsersTable para usar BadgeColor enum",
            "description": "Modificar app/Filament/Resources/UserResource/Tables/UsersTable.php para substituir lógica de cores de roles por BadgeColor::forRole().",
            "dependencies": [
              1
            ],
            "details": "Adicionar use App\\Enums\\BadgeColor no início do arquivo UsersTable.php. Localizar a coluna TextColumn::make('roles.name') e modificar o método color() para usar fn ($state) => BadgeColor::forRole($state)->value. Remover qualquer lógica inline anterior de cores baseada em roles. Verificar que o formatStateUsing está preservado para manter a formatação uppercase das roles.",
            "status": "done",
            "testStrategy": "Acessar http://localhost/admin/users e verificar visualmente que os badges de roles mantêm cores consistentes (super_admin vermelho, admin amarelo, operador azul, consulta verde). Testar com usuários de diferentes roles para validar todas as variações.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T19:43:31.998Z"
          },
          {
            "id": 4,
            "title": "Criar tests/Unit/BadgeColorEnumTest.php com cobertura completa",
            "description": "Implementar suite completa de testes unitários Pest para validar todos os métodos do enum BadgeColor, cobrindo todos os cases de forRole(), forSecrecy() e forValidity().",
            "dependencies": [
              1
            ],
            "details": "Criar arquivo tests/Unit/BadgeColorEnumTest.php usando sintaxe Pest. Implementar 6+ testes: (1) forRole retorna DANGER para super_admin, (2) forRole retorna WARNING para admin, (3) forSecrecy retorna DANGER para S, (4) forSecrecy retorna WARNING para R, (5) forValidity retorna DANGER para data passada, (6) forValidity retorna WARNING para data em 15 dias, (7) forValidity retorna SUCCESS para data em 1 ano. Usar Carbon para manipular datas nos testes. Adicionar testes de edge cases como null values.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test tests/Unit/BadgeColorEnumTest.php e verificar que todos os testes passam. Validar cobertura de 100% dos métodos públicos do enum. Confirmar que testes falham quando lógica é alterada propositalmente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T19:53:56.732Z"
          },
          {
            "id": 5,
            "title": "Documentar uso do enum BadgeColor no CLAUDE.md",
            "description": "Adicionar seção de documentação no arquivo CLAUDE.md explicando o uso do enum BadgeColor, com exemplos práticos de cada método estático e padrões de uso recomendados.",
            "dependencies": [
              1,
              2,
              3,
              4
            ],
            "details": "Adicionar nova seção '### Badge Color Centralization' no CLAUDE.md após a seção de Filament 4 Specific Patterns. Documentar os 3 métodos estáticos com exemplos de código: BadgeColor::forRole('super_admin'), BadgeColor::forSecrecy('S'), BadgeColor::forValidity($date). Incluir tabela de mapeamento role->cor e secrecy->cor. Adicionar nota sobre quando usar .value para obter string. Incluir exemplo de uso em TextColumn do Filament. Mencionar localização do arquivo de testes para referência.",
            "status": "done",
            "testStrategy": "Revisar CLAUDE.md para confirmar que a documentação está clara, completa e com exemplos funcionais. Validar que os code snippets estão corretos e podem ser copiados diretamente. Pedir feedback de outro desenvolvedor sobre clareza da documentação.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T19:55:15.526Z"
          }
        ]
      },
      {
        "id": "5",
        "title": "FASE 5: Suite Completa de Testes com Pest e Cobertura Filament",
        "description": "Refatorar testes existentes para usar factories, remover testes obsoletos, criar suite completa de testes Livewire para recursos Filament (Credentials e Users), implementar testes unitários de Policies e testes de integração para ActivityLog Observer, relacionamentos e soft deletes.",
        "details": "1. **Refatorar RoleAuthorizationTest para Usar Factories**:\n   ```php\n   // tests/Feature/RoleAuthorizationTest.php\n   use App\\Models\\User;\n   \n   it('super_admin pode acessar painel', function () {\n       $user = User::factory()->create();\n       $user->assignRole('super_admin');\n       \n       $this->actingAs($user)\n           ->get('/admin')\n           ->assertStatus(200);\n   });\n   ```\n\n2. **Deletar Teste Obsoleto**:\n   ```bash\n   rm tests/Feature/CredentialValidationTest.php\n   ```\n\n3. **Criar CredentialResourceTest Completo**:\n   ```bash\n   vendor/bin/sail artisan make:test Feature/Filament/CredentialResourceTest --pest\n   ```\n   ```php\n   use function Pest\\Livewire\\livewire;\n   \n   it('pode listar credenciais', function () {\n       $credentials = Credential::factory()->count(5)->create();\n       \n       livewire(ListCredentials::class)\n           ->assertCanSeeTableRecords($credentials);\n   });\n   \n   it('pode criar credencial', function () {\n       livewire(CreateCredential::class)\n           ->fillForm([\n               'fscs' => 'TEST-001',\n               'name' => 'Teste',\n               'secrecy' => 'R',\n               'validity' => now()->addYear()->format('Y-m-d'),\n           ])\n           ->call('create')\n           ->assertHasNoFormErrors();\n   });\n   \n   it('pode filtrar por secrecy', function () {\n       Credential::factory()->count(3)->create(['secrecy' => 'R']);\n       \n       livewire(ListCredentials::class)\n           ->filterTable('secrecy', 'R')\n           ->assertCountTableRecords(3);\n   });\n   ```\n\n4. **Criar UserResourceTest**:\n   ```php\n   it('pode criar usuário com role', function () {\n       livewire(CreateUser::class)\n           ->fillForm([\n               'name' => 'Novo',\n               'email' => 'novo@test.com',\n               'password' => 'password',\n               'roles' => ['admin'],\n           ])\n           ->call('create');\n       \n       expect(User::where('email', 'novo@test.com')->first())\n           ->hasRole('admin')->toBeTrue();\n   });\n   ```\n\n5. **Criar PolicyTest**:\n   ```php\n   it('super_admin pode tudo', function () {\n       $admin = User::factory()->create();\n       $admin->assignRole('super_admin');\n       $credential = Credential::factory()->create();\n       \n       $policy = new CredentialPolicy();\n       expect($policy->view($admin, $credential))->toBeTrue();\n       expect($policy->create($admin))->toBeTrue();\n   });\n   ```\n\n6. **Criar ActivityLogObserverTest**:\n   ```php\n   it('registra criação no log', function () {\n       $user = User::factory()->create();\n       Auth::login($user);\n       \n       Credential::factory()->create(['fscs' => 'LOG-001']);\n       \n       $this->assertDatabaseHas('activity_logs', [\n           'action' => 'created',\n           'user_id' => $user->id,\n       ]);\n   });\n   ```\n\n7. **Criar RelationshipsTest**:\n   ```php\n   it('user hasMany credentials', function () {\n       $user = User::factory()->create();\n       Credential::factory()->count(3)->create(['user_id' => $user->id]);\n       \n       expect($user->credentials)->toHaveCount(3);\n   });\n   \n   it('soft delete preserva credencial', function () {\n       $credential = Credential::factory()->create();\n       $credential->delete();\n       \n       $this->assertSoftDeleted('credentials', ['id' => $credential->id]);\n   });\n   ```",
        "testStrategy": "1. **Validar Refatoração**:\n   ```bash\n   vendor/bin/sail artisan test tests/Feature/RoleAuthorizationTest.php\n   ```\n\n2. **Confirmar Remoção**:\n   ```bash\n   ls tests/Feature/CredentialValidationTest.php # Deve falhar\n   ```\n\n3. **Suite Completa Filament**:\n   ```bash\n   vendor/bin/sail artisan test tests/Feature/Filament/ --coverage\n   ```\n   - Cobertura mínima 90%\n\n4. **Testes Unitários**:\n   ```bash\n   vendor/bin/sail artisan test tests/Unit/PolicyTest.php\n   ```\n\n5. **Cobertura Total**:\n   ```bash\n   vendor/bin/sail artisan test --coverage --min=80\n   ```\n\n6. **Teste Manual Painel**:\n   - Criar credencial via /admin/credentials\n   - Verificar activity_logs\n   - Deletar e confirmar soft delete\n\n7. **Execução Paralela**:\n   ```bash\n   vendor/bin/sail artisan test --parallel\n   ```",
        "priority": "high",
        "dependencies": [
          "2",
          "4"
        ],
        "status": "in-progress",
        "complexity": 8,
        "recommendedSubtasks": 10,
        "expansionPrompt": "Dividir em subtasks detalhadas: (1) Refatorar RoleAuthorizationTest para usar factories; (2) Remover o arquivo de teste obsoleto CredentialValidationTest; (3) Criar CredentialResourceTest com testes para listagem, filtros e paginação; (4) Adicionar testes de criação, edição e validação em CredentialResourceTest; (5) Criar UserResourceTest com testes de CRUD e atribuição de papéis (roles); (6) Criar testes unitários para a CredentialPolicy; (7) Criar testes de integração para o ActivityLogObserver; (8) Criar testes para os relacionamentos dos Models e soft deletes; (9) Configurar e executar a suite com análise de cobertura para atingir a meta de 80%; (10) Documentar as estratégias de teste do projeto.",
        "updatedAt": "2025-11-23T04:23:08.055Z",
        "subtasks": [
          {
            "id": 1,
            "title": "Refatorar RoleAuthorizationTest para usar factories",
            "description": "Modificar tests/Feature/RoleAuthorizationTest.php para substituir criação manual de usuários por User::factory(), garantindo que todos os testes usem factories do Laravel e Spatie Permission para atribuição de roles.",
            "dependencies": [],
            "details": "Abrir tests/Feature/RoleAuthorizationTest.php e substituir todas as instâncias de User::create() por User::factory()->create(). Manter a estrutura de testes existente (super_admin, admin, consulta) mas usar factories. Exemplo: $user = User::factory()->create(); $user->assignRole('super_admin'); $this->actingAs($user)->get('/admin')->assertStatus(200). Garantir que todos os testes passem após refatoração.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test tests/Feature/RoleAuthorizationTest.php e confirmar que todos os testes passam. Verificar que não há criação manual de usuários no arquivo.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T03:38:28.752Z"
          },
          {
            "id": 2,
            "title": "Remover CredentialValidationTest obsoleto",
            "description": "Deletar o arquivo tests/Feature/CredentialValidationTest.php que contém testes obsoletos ou redundantes, confirmando que nenhuma funcionalidade crítica será perdida.",
            "dependencies": [],
            "details": "Antes de deletar, revisar o conteúdo de tests/Feature/CredentialValidationTest.php para garantir que os testes não são mais necessários ou foram substituídos por testes melhores. Executar rm tests/Feature/CredentialValidationTest.php ou deletar via IDE. Confirmar que o arquivo não existe mais com ls tests/Feature/CredentialValidationTest.php (deve retornar erro).",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test para garantir que a suite completa ainda passa sem este arquivo. Verificar que ls tests/Feature/CredentialValidationTest.php retorna erro 'No such file or directory'.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T03:38:53.989Z"
          },
          {
            "id": 3,
            "title": "Criar CredentialResourceTest com testes de listagem e filtros",
            "description": "Criar tests/Feature/Filament/CredentialResourceTest.php usando Pest para testar componente Livewire ListCredentials, incluindo listagem de registros, paginação e filtros por secrecy.",
            "dependencies": [],
            "details": "Executar vendor/bin/sail artisan make:test Feature/Filament/CredentialResourceTest --pest. Implementar testes: (1) 'pode listar credenciais' usando livewire(ListCredentials::class)->assertCanSeeTableRecords($credentials); (2) 'pode filtrar por secrecy' criando 3 credenciais com secrecy='R' e testando ->filterTable('secrecy', 'R')->assertCountTableRecords(3); (3) 'pode ordenar por validity' testando ->sortTable('validity'). Usar Credential::factory() para criar dados de teste.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test tests/Feature/Filament/CredentialResourceTest.php --filter='pode listar credenciais'. Verificar que todos os testes de listagem e filtros passam sem erros.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T03:39:46.180Z"
          },
          {
            "id": 4,
            "title": "Adicionar testes de criação e edição em CredentialResourceTest",
            "description": "Expandir CredentialResourceTest com testes de criação e edição de credenciais através dos componentes Filament CreateCredential e EditCredential, incluindo validação de formulários.",
            "dependencies": [
              3
            ],
            "details": "No arquivo tests/Feature/Filament/CredentialResourceTest.php, adicionar: (1) 'pode criar credencial' usando livewire(CreateCredential::class)->fillForm(['fscs' => 'TEST-001', 'name' => 'Teste', 'secrecy' => 'R', 'validity' => now()->addYear()->format('Y-m-d')])->call('create')->assertHasNoFormErrors(); (2) 'pode editar credencial' carregando record existente e testando fillForm + call('save'); (3) 'valida fscs único' tentando criar credencial com FSCS duplicado e esperando erro; (4) 'valida validity futura' testando data passada.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test tests/Feature/Filament/CredentialResourceTest.php --filter='pode criar credencial'. Verificar que credencial foi criada no banco com assertDatabaseHas. Testar cenários de validação com assertHasFormErrors.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T03:39:51.093Z"
          },
          {
            "id": 5,
            "title": "Criar UserResourceTest com testes de CRUD e atribuição de roles",
            "description": "Criar tests/Feature/Filament/UserResourceTest.php para testar componentes Livewire de gerenciamento de usuários, incluindo criação, edição, listagem e atribuição de roles via Spatie Permission.",
            "dependencies": [],
            "details": "Executar vendor/bin/sail artisan make:test Feature/Filament/UserResourceTest --pest. Implementar: (1) 'pode listar usuários' com livewire(ListUsers::class)->assertCanSeeTableRecords(); (2) 'pode criar usuário com role' preenchendo formulário com name, email, password, roles=['admin'] e verificando hasRole('admin'); (3) 'pode editar usuário e trocar role' modificando role existente; (4) 'valida email único' tentando criar com email duplicado; (5) 'super_admin pode acessar recurso' testando canAccess().",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test tests/Feature/Filament/UserResourceTest.php. Verificar que User::where('email', 'novo@test.com')->first()->hasRole('admin') retorna true. Confirmar validações com assertHasFormErrors.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T03:43:02.007Z"
          },
          {
            "id": 6,
            "title": "Criar PolicyTest para testar CredentialPolicy e autorização",
            "description": "Criar tests/Unit/Policies/CredentialPolicyTest.php usando Pest para testar todos os métodos de autorização da CredentialPolicy, verificando permissões por role (super_admin, admin, consulta).",
            "dependencies": [],
            "details": "Criar tests/Unit/Policies/CredentialPolicyTest.php. Implementar: (1) 'super_admin pode tudo' testando viewAny, view, create, update, delete retornam true; (2) 'admin pode gerenciar credenciais' testando mesmas permissões; (3) 'consulta só pode visualizar' testando view=true mas create/update/delete=false; (4) 'usuário sem role não tem acesso' testando todas as permissões retornam false. Usar User::factory() com assignRole() e Credential::factory(). Instanciar CredentialPolicy diretamente para testar métodos.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test tests/Unit/Policies/CredentialPolicyTest.php. Confirmar que expect($policy->view($admin, $credential))->toBeTrue() passa para super_admin e admin, mas create retorna false para role consulta.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T03:50:39.925Z"
          },
          {
            "id": 7,
            "title": "Criar ActivityLogObserverTest para validar logging de ações",
            "description": "Criar tests/Feature/ActivityLogObserverTest.php para testar o Observer que registra ações de criação, atualização e exclusão de credenciais na tabela activity_logs, incluindo user_id correto.",
            "dependencies": [],
            "details": "Executar vendor/bin/sail artisan make:test Feature/ActivityLogObserverTest --pest. Implementar: (1) 'registra criação no log' criando credencial autenticado como usuário e verificando assertDatabaseHas('activity_logs', ['action' => 'created', 'user_id' => $user->id]); (2) 'registra atualização' testando update e action='updated'; (3) 'registra exclusão' testando delete e action='deleted'; (4) 'armazena dados relevantes' verificando que model_type e model_id estão corretos. Usar Auth::login($user) antes das operações.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test tests/Feature/ActivityLogObserverTest.php. Confirmar que após Credential::factory()->create() existe registro em activity_logs com $this->assertDatabaseHas(). Verificar user_id corresponde ao usuário autenticado.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T03:54:32.093Z"
          },
          {
            "id": 8,
            "title": "Criar RelationshipsTest para User-Credentials e soft deletes",
            "description": "Criar tests/Unit/Models/RelationshipsTest.php usando Pest para testar relacionamentos Eloquent entre User e Credential, comportamento de soft delete e integridade referencial com SET NULL.",
            "dependencies": [],
            "details": "Criar tests/Unit/Models/RelationshipsTest.php. Implementar: (1) 'user hasMany credentials' criando 3 credenciais vinculadas a user e testando $user->credentials->toHaveCount(3); (2) 'credential belongsTo user' testando $credential->user->is($expectedUser); (3) 'soft delete preserva credencial' deletando credencial e testando assertSoftDeleted('credentials', ['id' => $credential->id]); (4) 'deletar user seta credential.user_id como NULL' deletando user e verificando que credential existe mas user_id é null (SET NULL constraint); (5) 'withTrashed recupera soft deleted'.",
            "status": "done",
            "testStrategy": "Executar vendor/bin/sail artisan test tests/Unit/Models/RelationshipsTest.php. Verificar que $user->credentials carrega coleção correta. Confirmar que após $credential->delete(), Credential::withTrashed()->find($id) retorna o registro.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T03:59:05.974Z"
          },
          {
            "id": 9,
            "title": "Executar suite completa de testes com coverage mínimo 80%",
            "description": "Executar toda a suite de testes do projeto usando Pest, gerar relatório de cobertura de código com PHPUnit/PCOV, analisar resultados e identificar gaps de cobertura para atingir mínimo de 80%.",
            "dependencies": [
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8
            ],
            "details": "Executar vendor/bin/sail artisan test --coverage --min=80. Analisar relatório de cobertura gerado. Se cobertura < 80%, identificar arquivos com baixa cobertura (Models, Policies, Resources, Observers) e adicionar testes faltantes. Focar em: (1) Models (User, Credential) - testar getters, scopes, relationships; (2) Policies não cobertas; (3) Observers edge cases; (4) Resource actions customizadas. Repetir até atingir 80%+. Gerar relatório HTML com --coverage-html coverage_report se disponível.",
            "status": "done",
            "testStrategy": "Comando vendor/bin/sail artisan test --coverage deve passar com Lines >= 80%. Revisar output do terminal ou arquivo coverage_report/index.html. Confirmar que arquivos críticos (User.php, Credential.php, CredentialPolicy.php) têm >80% de cobertura individualmente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T04:02:16.766Z"
          },
          {
            "id": 10,
            "title": "Documentar estratégias de teste em best-practices",
            "description": "Criar ou atualizar documento .taskmaster/docs/testing-strategies.md com padrões de teste do projeto, exemplos de uso de Pest com Filament, factories, Livewire testing e guidelines de cobertura para futuros desenvolvedores.",
            "dependencies": [
              9
            ],
            "details": "Criar .taskmaster/docs/testing-strategies.md documentando: (1) Estrutura de testes (Feature vs Unit, quando usar cada); (2) Padrões Pest específicos do projeto (it(), beforeEach(), datasets); (3) Testing Filament/Livewire com livewire()->fillForm()->call()->assert*; (4) Uso de factories para User e Credential; (5) Testing Policies diretamente vs Gates; (6) Testing Observers com Auth mock; (7) Comandos úteis (test --filter, --coverage, --parallel); (8) Exemplo completo de teste de Resource Filament; (9) Troubleshooting comum. Referenciar este doc em CLAUDE.md seção 'Testing Requirements'.",
            "status": "in-progress",
            "testStrategy": "Revisar documento criado manualmente. Confirmar que contém exemplos de código executáveis. Testar um dos exemplos copiando código e executando para validar que documentação está correta e atualizada.",
            "parentId": "undefined",
            "updatedAt": "2025-11-23T04:23:08.055Z"
          }
        ]
      },
      {
        "id": "6",
        "title": "FASE 6: Deploy e Performance - CI/CD, Cache e Queue",
        "description": "Configurar pipeline de CI/CD com GitHub Actions, implementar estratégias de cache (config, routes, views), configurar Laravel Queue para jobs assíncronos, otimizar queries N+1 com eager loading e preparar ambiente de produção.",
        "details": "1. **Configurar GitHub Actions para CI/CD**:\n\n   Criar `.github/workflows/laravel.yml`:\n   ```yaml\n   name: Laravel CI\n   \n   on:\n     push:\n       branches: [ main ]\n     pull_request:\n       branches: [ main ]\n   \n   jobs:\n     tests:\n       runs-on: ubuntu-latest\n       \n       services:\n         mysql:\n           image: mysql:8.0\n           env:\n             MYSQL_ROOT_PASSWORD: password\n             MYSQL_DATABASE: testing\n           ports:\n             - 3306:3306\n       \n       steps:\n         - uses: actions/checkout@v3\n         \n         - name: Setup PHP\n           uses: shivammathur/setup-php@v2\n           with:\n             php-version: '8.3'\n             extensions: mbstring, pdo_mysql\n         \n         - name: Install Dependencies\n           run: composer install --no-interaction\n         \n         - name: Copy .env\n           run: cp .env.example .env\n         \n         - name: Generate Key\n           run: php artisan key:generate\n         \n         - name: Run Migrations\n           run: php artisan migrate --force\n         \n         - name: Run Tests\n           run: php artisan test --coverage\n         \n         - name: Run Pint\n           run: ./vendor/bin/pint --test\n   ```\n\n2. **Implementar Estratégias de Cache**:\n\n   Criar comando de deploy `deploy.sh`:\n   ```bash\n   #!/bin/bash\n   echo \"Deploying application...\"\n   \n   # Pull latest code\n   git pull origin main\n   \n   # Install dependencies\n   composer install --optimize-autoloader --no-dev\n   \n   # Cache configurations\n   php artisan config:cache\n   php artisan route:cache\n   php artisan view:cache\n   \n   # Run migrations\n   php artisan migrate --force\n   \n   # Clear old caches\n   php artisan cache:clear\n   \n   # Restart queue workers\n   php artisan queue:restart\n   \n   echo \"Deployment complete!\"\n   ```\n\n3. **Configurar Laravel Queue**:\n\n   Criar job para notificações:\n   ```bash\n   vendor/bin/sail artisan make:job NotifyExpiringCredentials\n   ```\n   ```php\n   <?php\n   namespace App\\Jobs;\n   \n   use App\\Models\\Credential;\n   use Illuminate\\Bus\\Queueable;\n   use Illuminate\\Contracts\\Queue\\ShouldQueue;\n   use Illuminate\\Foundation\\Bus\\Dispatchable;\n   \n   class NotifyExpiringCredentials implements ShouldQueue\n   {\n       use Dispatchable, Queueable;\n       \n       public function handle(): void\n       {\n           $expiringCredentials = Credential::whereBetween('validity', [\n               now(),\n               now()->addDays(30),\n           ])->get();\n           \n           // Enviar notificações\n           foreach ($expiringCredentials as $credential) {\n               // Log ou enviar email\n               \\Log::warning(\"Credential {$credential->fscs} expiring soon\");\n           }\n       }\n   }\n   ```\n\n   Configurar Horizon para monitoramento (opcional):\n   ```bash\n   composer require laravel/horizon\n   php artisan horizon:install\n   ```\n\n4. **Otimizar Queries N+1**:\n\n   Atualizar Resources para usar eager loading:\n   ```php\n   // CredentialResource.php\n   public static function getEloquentQuery(): Builder\n   {\n       return parent::getEloquentQuery()\n           ->with(['user']); // Eager load user\n   }\n   ```\n\n   Habilitar detecção de N+1 em desenvolvimento:\n   ```php\n   // AppServiceProvider.php\n   public function boot(): void\n   {\n       if (app()->environment('local')) {\n           DB::listen(function ($query) {\n               if ($query->time > 100) {\n                   \\Log::warning('Slow query detected', [\n                       'sql' => $query->sql,\n                       'time' => $query->time,\n                   ]);\n               }\n           });\n       }\n   }\n   ```\n\n5. **Configurar Ambiente de Produção**:\n\n   Criar `.env.production.example`:\n   ```env\n   APP_ENV=production\n   APP_DEBUG=false\n   APP_URL=https://yourdomain.com\n   \n   DB_CONNECTION=mysql\n   DB_HOST=your-production-host\n   DB_PORT=3306\n   DB_DATABASE=cred_crud_prod\n   DB_USERNAME=prod_user\n   DB_PASSWORD=secure_password\n   \n   CACHE_DRIVER=redis\n   QUEUE_CONNECTION=redis\n   SESSION_DRIVER=redis\n   \n   REDIS_HOST=redis\n   REDIS_PASSWORD=null\n   REDIS_PORT=6379\n   ```\n\n6. **Implementar Health Check Endpoint**:\n   ```php\n   // routes/web.php\n   Route::get('/health', function () {\n       return response()->json([\n           'status' => 'ok',\n           'database' => DB::connection()->getDatabaseName(),\n           'cache' => Cache::has('health_check'),\n       ]);\n   });\n   ```",
        "testStrategy": "1. **Teste de CI/CD Pipeline**:\n   - Push para branch e verificar GitHub Actions\n   - Confirmar que todos os jobs passam\n   - Verificar cobertura de testes\n\n2. **Teste de Cache**:\n   ```bash\n   vendor/bin/sail artisan config:cache\n   vendor/bin/sail artisan route:cache\n   # Verificar que aplicação funciona normalmente\n   vendor/bin/sail artisan optimize:clear\n   ```\n\n3. **Teste de Queue Jobs**:\n   ```bash\n   vendor/bin/sail artisan queue:work &\n   vendor/bin/sail artisan tinker --execute=\"\\App\\Jobs\\NotifyExpiringCredentials::dispatch();\"\n   # Verificar logs\n   ```\n\n4. **Teste de N+1 Queries**:\n   ```bash\n   vendor/bin/sail artisan tinker\n   ```\n   ```php\n   DB::enableQueryLog();\n   $credentials = Credential::with('user')->get();\n   dd(count(DB::getQueryLog())); // Deve ser 1 query\n   ```\n\n5. **Teste de Health Check**:\n   ```bash\n   curl http://localhost/health\n   ```\n   - Deve retornar JSON com status: ok\n\n6. **Performance Benchmark**:\n   ```bash\n   ab -n 1000 -c 10 http://localhost/admin\n   ```\n   - Verificar tempo de resposta médio",
        "priority": "medium",
        "dependencies": [
          "3",
          "5"
        ],
        "status": "pending",
        "complexity": 7,
        "recommendedSubtasks": 9,
        "expansionPrompt": "Decompor em: (1) Criar o arquivo de workflow .github/workflows/laravel.yml com jobs para testes e linting; (2) Configurar o service container do MySQL no GitHub Actions para o ambiente de teste; (3) Criar um script de deploy (deploy.sh) com comandos de otimização; (4) Criar o Job assíncrono NotifyExpiringCredentials; (5) Configurar o driver de fila (ex: Redis) e testar o despacho de jobs; (6) Implementar eager loading nos Eloquent queries para evitar problemas de N+1; (7) Implementar um listener para detecção de queries lentas em ambiente de desenvolvimento; (8) Criar um arquivo .env.production.example com configurações seguras; (9) Implementar um endpoint de health check.",
        "updatedAt": "2025-11-20T00:00:00.000Z",
        "subtasks": [
          {
            "id": 1,
            "title": "Criar Workflow do GitHub Actions para CI/CD",
            "description": "Desenvolver o arquivo `.github/workflows/laravel.yml` para automatizar testes, linting (Pint) e verificação de cobertura de testes a cada push ou pull request na branch `main`.",
            "dependencies": [],
            "details": "O workflow deve incluir steps para checkout do código, setup do PHP, instalação de dependências com Composer, configuração do ambiente `.env`, geração da chave da aplicação, execução de migrations, testes (com coverage) e verificação de estilo de código com Pint.",
            "status": "pending",
            "testStrategy": "Fazer um push para uma branch de teste que tenha um pull request aberto para a `main`. Verificar se a action é acionada e se todos os jobs (tests, pint) são executados com sucesso.",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Configurar Service Container do MySQL no GitHub Actions",
            "description": "Adicionar a configuração de um service container do MySQL 8.0 ao job de testes no workflow do GitHub Actions para prover um banco de dados para os testes de integração.",
            "dependencies": [
              1
            ],
            "details": "Dentro do job `tests` no arquivo `laravel.yml`, adicionar a seção `services` para iniciar um container MySQL, definindo as variáveis de ambiente `MYSQL_ROOT_PASSWORD` e `MYSQL_DATABASE` e mapeando a porta 3306.",
            "status": "pending",
            "testStrategy": "Verificar se os testes que dependem do banco de dados (por exemplo, os que usam migrations) passam com sucesso durante a execução do workflow no GitHub Actions.",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Criar Script de Deploy (`deploy.sh`) com Otimizações",
            "description": "Desenvolver um script shell (`deploy.sh`) para automatizar o processo de deploy, incluindo pulling do código, instalação de dependências, cache de configuração, rotas e views, e execução de migrations.",
            "dependencies": [],
            "details": "O script deve executar `git pull`, `composer install --optimize-autoloader --no-dev`, `php artisan config:cache`, `php artisan route:cache`, `php artisan view:cache`, `php artisan migrate --force`, e `php artisan queue:restart`.",
            "status": "pending",
            "testStrategy": "Executar o script localmente em um ambiente de desenvolvimento limpo para garantir que todos os comandos são executados sem erro e a aplicação continua funcional.",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Criar Job Assíncrono `NotifyExpiringCredentials` para Filas",
            "description": "Gerar e implementar um Laravel Job chamado `NotifyExpiringCredentials` que busca credenciais próximas do vencimento e dispara uma notificação (inicialmente, um log).",
            "dependencies": [],
            "details": "Usar o comando `php artisan make:job NotifyExpiringCredentials`. No método `handle()`, implementar a lógica para buscar credenciais que expiram nos próximos 30 dias e registrar um aviso no log para cada uma.",
            "status": "pending",
            "testStrategy": "Disparar o job manualmente via `php artisan tinker` (`App\\Jobs\\NotifyExpiringCredentials::dispatch()`) com o driver de fila `sync` e verificar se os logs de aviso são gerados corretamente no arquivo `laravel.log`.",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Configurar Driver de Fila para Redis e Testar o Dispatching",
            "description": "Configurar o Laravel para usar Redis como driver de fila no ambiente de produção e testar o envio de jobs para a fila. Opcionalmente, instalar e configurar o Laravel Horizon para monitoramento.",
            "dependencies": [
              4
            ],
            "details": "Alterar a variável `QUEUE_CONNECTION` para `redis` no arquivo `.env`. Instalar o `laravel/horizon` (opcional). Despachar o job `NotifyExpiringCredentials` e verificar se ele é processado pelo worker da fila.",
            "status": "pending",
            "testStrategy": "Iniciar o worker da fila (`php artisan queue:work`). Despachar o job e verificar se o log correspondente é gerado, confirmando que o job foi processado de forma assíncrona. Se o Horizon estiver instalado, verificar o dashboard do Horizon.",
            "parentId": "undefined"
          },
          {
            "id": 6,
            "title": "Adicionar Eager Loading no `CredentialResource` para Evitar N+1",
            "description": "Otimizar a consulta de credenciais no Filament Resource, implementando eager loading para a relação `user` para prevenir o problema de queries N+1.",
            "dependencies": [],
            "details": "Sobrescrever o método `getEloquentQuery()` na classe `app/Filament/Resources/CredentialResource.php` e adicionar `->with(['user'])` à query para carregar a relação `user` antecipadamente.",
            "status": "pending",
            "testStrategy": "Usar uma ferramenta como Laravel Telescope ou Laravel Debugbar para monitorar as queries executadas na página de listagem de `CredentialResource` e confirmar que o número de queries ao banco de dados foi reduzido para um valor constante.",
            "parentId": "undefined"
          },
          {
            "id": 7,
            "title": "Implementar Detecção Automática de Queries N+1 e Lentas",
            "description": "Adicionar um listener de queries no `AppServiceProvider` que, em ambiente local, detecta e loga queries lentas (> 100ms) para ajudar na identificação de gargalos de performance.",
            "dependencies": [],
            "details": "No método `boot()` de `app/Providers/AppServiceProvider.php`, adicionar um `DB::listen()` que verifica a duração de cada query. Se `app()->environment('local')` for verdadeiro e a query demorar mais de 100ms, registrar um aviso no log.",
            "status": "pending",
            "testStrategy": "Criar uma query artificialmente lenta (ex: com `sleep()`) em uma rota de teste. Acessar a rota em ambiente local e verificar se o aviso de 'Slow query detected' é registrado no arquivo `laravel.log`.",
            "parentId": "undefined"
          },
          {
            "id": 8,
            "title": "Criar Arquivo de Exemplo para Ambiente de Produção (`.env.production.example`)",
            "description": "Preparar um arquivo `.env.production.example` com configurações seguras e otimizadas para um ambiente de produção, incluindo desativar debug e usar Redis para cache, filas e sessões.",
            "dependencies": [
              5
            ],
            "details": "Criar o arquivo `.env.production.example` e definir `APP_ENV=production`, `APP_DEBUG=false`, placeholders para o banco de dados de produção, e configurar `CACHE_DRIVER`, `QUEUE_CONNECTION`, e `SESSION_DRIVER` para `redis`.",
            "status": "pending",
            "testStrategy": "Copiar `.env.production.example` para `.env` em um ambiente de teste, preencher os placeholders e verificar se a aplicação inicia corretamente com as configurações de produção.",
            "parentId": "undefined"
          },
          {
            "id": 9,
            "title": "Implementar Endpoint de Health Check e Realizar Teste E2E do Pipeline",
            "description": "Criar uma rota `/health` que verifica o status da aplicação, incluindo a conexão com o banco de dados e o cache. Realizar um teste completo do pipeline de CI/CD para garantir a integração.",
            "dependencies": [
              1,
              2,
              3,
              5,
              8
            ],
            "details": "Adicionar a rota `GET /health` no arquivo `routes/web.php` que retorna um JSON com o status da aplicação, do banco de dados e do cache. Após configurar tudo, fazer um PR para a `main` para acionar o pipeline completo.",
            "status": "pending",
            "testStrategy": "Acessar o endpoint `/health` e verificar se a resposta é um JSON com `status: ok`. Verificar se o pipeline completo do GitHub Actions passa com sucesso, incluindo testes e linting.",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "7",
        "title": "FASE 7: Manutenção e Monitoramento - Logs, Metrics e Backup",
        "description": "Implementar sistema de logging estruturado, configurar monitoramento de métricas (response time, queries), criar rotina automatizada de backup do banco de dados e implementar alertas para credenciais expirando.",
        "details": "1. **Configurar Logging Estruturado**:\n\n   Atualizar `config/logging.php`:\n   ```php\n   'channels' => [\n       'daily' => [\n           'driver' => 'daily',\n           'path' => storage_path('logs/laravel.log'),\n           'level' => env('LOG_LEVEL', 'debug'),\n           'days' => 14,\n       ],\n       \n       'security' => [\n           'driver' => 'daily',\n           'path' => storage_path('logs/security.log'),\n           'level' => 'warning',\n           'days' => 90, // Manter logs de segurança por mais tempo\n       ],\n       \n       'audit' => [\n           'driver' => 'daily',\n           'path' => storage_path('logs/audit.log'),\n           'level' => 'info',\n           'days' => 365, // Auditoria por 1 ano\n       ],\n   ];\n   ```\n\n   Criar Middleware de Auditoria:\n   ```php\n   <?php\n   namespace App\\Http\\Middleware;\n   \n   use Closure;\n   use Illuminate\\Support\\Facades\\Log;\n   \n   class AuditMiddleware\n   {\n       public function handle($request, Closure $next)\n       {\n           $response = $next($request);\n           \n           if ($request->user()) {\n               Log::channel('audit')->info('User action', [\n                   'user_id' => $request->user()->id,\n                   'email' => $request->user()->email,\n                   'action' => $request->method(),\n                   'url' => $request->fullUrl(),\n                   'ip' => $request->ip(),\n               ]);\n           }\n           \n           return $response;\n       }\n   }\n   ```\n\n2. **Implementar Monitoramento de Métricas**:\n\n   Criar comando para coletar métricas:\n   ```bash\n   vendor/bin/sail artisan make:command CollectMetrics\n   ```\n   ```php\n   <?php\n   namespace App\\Console\\Commands;\n   \n   use App\\Models\\Credential;\n   use App\\Models\\User;\n   use Illuminate\\Console\\Command;\n   use Illuminate\\Support\\Facades\\DB;\n   \n   class CollectMetrics extends Command\n   {\n       protected $signature = 'metrics:collect';\n       protected $description = 'Coleta métricas do sistema';\n       \n       public function handle()\n       {\n           $metrics = [\n               'timestamp' => now()->toIso8601String(),\n               'credentials' => [\n                   'total' => Credential::count(),\n                   'expired' => Credential::where('validity', '<', now())->count(),\n                   'expiring_soon' => Credential::whereBetween('validity', [\n                       now(),\n                       now()->addDays(30),\n                   ])->count(),\n               ],\n               'users' => [\n                   'total' => User::count(),\n                   'active_today' => DB::table('activity_logs')\n                       ->whereDate('created_at', today())\n                       ->distinct('user_id')\n                       ->count(),\n               ],\n               'database' => [\n                   'size_mb' => DB::select(\n                       \"SELECT ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) as size \n                       FROM information_schema.tables \n                       WHERE table_schema = ?\",\n                       [config('database.connections.mysql.database')]\n                   )[0]->size ?? 0,\n               ],\n           ];\n           \n           // Salvar em arquivo JSON\n           $metricsPath = storage_path('metrics');\n           if (!file_exists($metricsPath)) {\n               mkdir($metricsPath, 0755, true);\n           }\n           \n           file_put_contents(\n               $metricsPath . '/metrics_' . now()->format('Y-m-d') . '.json',\n               json_encode($metrics, JSON_PRETTY_PRINT)\n           );\n           \n           $this->info('Métricas coletadas com sucesso!');\n       }\n   }\n   ```\n\n3. **Criar Rotina de Backup Automatizado**:\n\n   Criar comando de backup:\n   ```bash\n   vendor/bin/sail artisan make:command BackupDatabase\n   ```\n   ```php\n   <?php\n   namespace App\\Console\\Commands;\n   \n   use Illuminate\\Console\\Command;\n   use Illuminate\\Support\\Facades\\Storage;\n   \n   class BackupDatabase extends Command\n   {\n       protected $signature = 'db:backup {--keep=7}';\n       protected $description = 'Cria backup do banco de dados';\n       \n       public function handle()\n       {\n           $filename = 'backup_' . now()->format('Y-m-d_H-i-s') . '.sql';\n           $path = storage_path('app/backups');\n           \n           if (!file_exists($path)) {\n               mkdir($path, 0755, true);\n           }\n           \n           $database = config('database.connections.mysql.database');\n           $username = config('database.connections.mysql.username');\n           $password = config('database.connections.mysql.password');\n           $host = config('database.connections.mysql.host');\n           \n           $command = sprintf(\n               'mysqldump -h%s -u%s -p%s %s > %s',\n               escapeshellarg($host),\n               escapeshellarg($username),\n               escapeshellarg($password),\n               escapeshellarg($database),\n               escapeshellarg($path . '/' . $filename)\n           );\n           \n           exec($command, $output, $returnVar);\n           \n           if ($returnVar === 0) {\n               $this->info(\"Backup criado: {$filename}\");\n               $this->cleanOldBackups($path, $this->option('keep'));\n           } else {\n               $this->error('Erro ao criar backup!');\n           }\n       }\n       \n       private function cleanOldBackups(string $path, int $keep): void\n       {\n           $files = glob($path . '/backup_*.sql');\n           usort($files, fn($a, $b) => filemtime($b) - filemtime($a));\n           \n           $toDelete = array_slice($files, $keep);\n           foreach ($toDelete as $file) {\n               unlink($file);\n               $this->info(\"Backup antigo removido: \" . basename($file));\n           }\n       }\n   }\n   ```\n\n4. **Implementar Alertas de Credenciais Expirando**:\n\n   Criar comando de notificação:\n   ```bash\n   vendor/bin/sail artisan make:command NotifyExpiringCredentials\n   ```\n   ```php\n   <?php\n   namespace App\\Console\\Commands;\n   \n   use App\\Models\\Credential;\n   use Illuminate\\Console\\Command;\n   use Illuminate\\Support\\Facades\\Log;\n   \n   class NotifyExpiringCredentials extends Command\n   {\n       protected $signature = 'credentials:notify-expiring';\n       protected $description = 'Notifica sobre credenciais expirando';\n       \n       public function handle()\n       {\n           $expiring = Credential::whereBetween('validity', [\n               now(),\n               now()->addDays(30),\n           ])->with('user')->get();\n           \n           if ($expiring->isEmpty()) {\n               $this->info('Nenhuma credencial expirando nos próximos 30 dias.');\n               return;\n           }\n           \n           $this->warn(\"⚠️  {$expiring->count()} credenciais expirando:\");\n           \n           foreach ($expiring as $credential) {\n               $daysLeft = now()->diffInDays($credential->validity);\n               $message = \"- {$credential->fscs}: {$credential->name} (expira em {$daysLeft} dias)\";\n               \n               $this->line($message);\n               \n               Log::channel('security')->warning('Credencial expirando', [\n                   'fscs' => $credential->fscs,\n                   'name' => $credential->name,\n                   'validity' => $credential->validity,\n                   'days_left' => $daysLeft,\n                   'user' => $credential->user?->name,\n               ]);\n           }\n       }\n   }\n   ```\n\n5. **Agendar Comandos no Scheduler**:\n\n   Atualizar `app/Console/Kernel.php`:\n   ```php\n   protected function schedule(Schedule $schedule): void\n   {\n       // Backup diário às 2h da manhã\n       $schedule->command('db:backup --keep=30')\n           ->dailyAt('02:00')\n           ->onFailure(function () {\n               Log::channel('security')->error('Falha no backup automático');\n           });\n       \n       // Coletar métricas a cada hora\n       $schedule->command('metrics:collect')\n           ->hourly();\n       \n       // Notificar credenciais expirando (diariamente às 9h)\n       $schedule->command('credentials:notify-expiring')\n           ->dailyAt('09:00');\n   }\n   ```\n\n6. **Criar Dashboard de Métricas (Opcional)**:\n\n   Criar página Filament para visualizar métricas:\n   ```bash\n   vendor/bin/sail artisan make:filament-page MetricsDashboard\n   ```",
        "testStrategy": "1. **Teste de Logging**:\n   ```bash\n   vendor/bin/sail artisan tinker\n   ```\n   ```php\n   Log::channel('security')->warning('Teste de segurança');\n   Log::channel('audit')->info('Teste de auditoria');\n   ```\n   - Verificar arquivos criados:\n   ```bash\n   ls -la storage/logs/\n   ```\n\n2. **Teste de Coleta de Métricas**:\n   ```bash\n   vendor/bin/sail artisan metrics:collect\n   cat storage/metrics/metrics_$(date +%Y-%m-%d).json\n   ```\n   - Verificar JSON com dados corretos\n\n3. **Teste de Backup**:\n   ```bash\n   vendor/bin/sail artisan db:backup\n   ls -la storage/app/backups/\n   ```\n   - Verificar que arquivo .sql foi criado\n   - Testar restauração:\n   ```bash\n   mysql -u sail -p cred_crud < storage/app/backups/backup_*.sql\n   ```\n\n4. **Teste de Alertas**:\n   ```bash\n   # Criar credencial expirando\n   vendor/bin/sail artisan tinker --execute=\"Credential::factory()->expiringSoon()->create();\"\n   vendor/bin/sail artisan credentials:notify-expiring\n   ```\n   - Verificar output no terminal\n   - Verificar log em storage/logs/security.log\n\n5. **Teste de Scheduler**:\n   ```bash\n   vendor/bin/sail artisan schedule:list\n   ```\n   - Confirmar que comandos estão agendados\n   ```bash\n   vendor/bin/sail artisan schedule:test\n   ```\n\n6. **Teste de Limpeza de Backups Antigos**:\n   ```bash\n   # Criar múltiplos backups\n   for i in {1..10}; do vendor/bin/sail artisan db:backup; sleep 1; done\n   vendor/bin/sail artisan db:backup --keep=3\n   ls -la storage/app/backups/ | wc -l # Deve ser 3\n   ```\n\n7. **Monitoramento Contínuo**:\n   - Configurar cron para executar scheduler:\n   ```bash\n   * * * * * cd /path-to-project && php artisan schedule:run >> /dev/null 2>&1\n   ```",
        "priority": "medium",
        "dependencies": [
          "5",
          "6"
        ],
        "status": "pending",
        "complexity": 6,
        "recommendedSubtasks": 8,
        "expansionPrompt": "Dividir em: (1) Configurar os canais de logging (daily, security, audit) em config/logging.php; (2) Criar e registrar um AuditMiddleware para log de ações do usuário; (3) Criar o comando Artisan 'CollectMetrics' para coletar e salvar métricas do sistema; (4) Criar o comando Artisan 'BackupDatabase' com funcionalidade de limpeza de backups antigos; (5) Criar o comando 'NotifyExpiringCredentials' para alertas; (6) Agendar todos os novos comandos no Console/Kernel; (7) Testar a execução individual e agendada de cada comando; (8) Documentar as novas rotinas de manutenção e monitoramento.",
        "updatedAt": "2025-11-20T00:00:00.000Z",
        "subtasks": [
          {
            "id": 1,
            "title": "Configurar Canais de Logging Estruturado (daily, security, audit)",
            "description": "Atualizar o arquivo `config/logging.php` para incluir três canais de log distintos: 'daily' para logs gerais, 'security' para avisos de segurança e 'audit' para trilhas de auditoria, cada um com sua própria política de retenção.",
            "dependencies": [],
            "details": "Adicionar as configurações dos canais 'daily', 'security', e 'audit' no array `channels` dentro de `config/logging.php`, conforme o código fornecido na tarefa pai, ajustando os dias de retenção para cada um.",
            "status": "pending",
            "testStrategy": "Verificar a criação dos arquivos de log em `storage/logs/` após disparar eventos de log para cada canal usando `php artisan tinker`. Exemplo: `Log::channel('security')->warning('Teste de segurança');` e `Log::channel('audit')->info('Teste de auditoria');`",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Criar e Registrar o Middleware de Auditoria de Ações do Usuário",
            "description": "Desenvolver um middleware (`AuditMiddleware`) que registra as ações dos usuários autenticados no canal de log 'audit'. O middleware deve ser aplicado às rotas relevantes para capturar a atividade do usuário.",
            "dependencies": [
              1
            ],
            "details": "Criar o arquivo `app/Http/Middleware/AuditMiddleware.php` com a lógica para registrar `user_id`, `email`, `action`, `url` e `ip`. Registrar o middleware no `app/Http/Kernel.php` para ser aplicado globalmente ou em grupos de rotas específicos.",
            "status": "pending",
            "testStrategy": "Após aplicar o middleware, navegar por páginas protegidas por autenticação, realizar algumas ações (visualizar, criar, editar) e verificar se as ações são registradas corretamente com todos os detalhes no arquivo `storage/logs/audit.log`.",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Implementar o Comando Artisan `metrics:collect`",
            "description": "Criar um comando Artisan que coleta métricas chave do sistema, como contagem de usuários, contagem de credenciais (total, expiradas, expirando em breve) e o tamanho do banco de dados. As métricas devem ser salvas em um arquivo JSON diário.",
            "dependencies": [],
            "details": "Gerar o comando `CollectMetrics` usando `artisan make:command`. Implementar a lógica para buscar dados dos models `User` e `Credential` e consultar o `information_schema` para o tamanho do banco. Salvar a saída em `storage/metrics/metrics_YYYY-MM-DD.json`.",
            "status": "pending",
            "testStrategy": "Executar o comando `php artisan metrics:collect` e verificar se o arquivo JSON é criado em `storage/metrics/` com a estrutura e os dados corretos e consistentes com o estado atual do banco de dados.",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Implementar o Comando Artisan `db:backup` para Backup do Banco de Dados",
            "description": "Desenvolver um comando Artisan que realiza um backup completo do banco de dados MySQL usando `mysqldump`. O comando deve também incluir uma funcionalidade para limpar backups antigos, mantendo um número configurável de cópias.",
            "dependencies": [],
            "details": "Gerar o comando `BackupDatabase` com a opção `--keep`. A lógica deve construir e executar o comando `mysqldump` com as credenciais do banco de dados. Implementar a função `cleanOldBackups` para gerenciar a rotação dos arquivos de backup em `storage/app/backups/`.",
            "status": "pending",
            "testStrategy": "Executar `php artisan db:backup --keep=3`. Verificar se o arquivo de backup `.sql` foi criado em `storage/app/backups/`. Executar o comando quatro vezes para garantir que o backup mais antigo é removido corretamente.",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Implementar o Comando Artisan `credentials:notify-expiring`",
            "description": "Criar um comando Artisan que verifica o banco de dados por credenciais que estão prestes a expirar (nos próximos 30 dias) e gera um log de aviso no canal 'security' para cada uma, além de exibir um resumo no console.",
            "dependencies": [
              1
            ],
            "details": "Gerar o comando `NotifyExpiringCredentials`. Implementar a query que busca credenciais com a data de `validity` entre `now()` e `now()->addDays(30)`. Para cada credencial encontrada, registrar um `Log::channel('security')->warning(...)` com os detalhes.",
            "status": "pending",
            "testStrategy": "Criar no banco de dados algumas credenciais de teste que expiram em 5, 15 e 29 dias. Executar `php artisan credentials:notify-expiring` e verificar tanto o output no console quanto as entradas de log detalhadas no arquivo `storage/logs/security.log`.",
            "parentId": "undefined"
          },
          {
            "id": 6,
            "title": "Agendar a Execução dos Comandos de Manutenção no `Console/Kernel.php`",
            "description": "Configurar o Agendador de Tarefas (Scheduler) do Laravel para executar automaticamente os comandos `db:backup`, `metrics:collect`, e `credentials:notify-expiring` em intervalos definidos (diário, de hora em hora, etc.).",
            "dependencies": [
              3,
              4,
              5
            ],
            "details": "Editar o método `schedule` em `app/Console/Kernel.php`. Adicionar agendamentos para: `db:backup --keep=30` (diário às 02:00), `metrics:collect` (de hora em hora), e `credentials:notify-expiring` (diário às 09:00). Incluir tratamento de falha para o backup.",
            "status": "pending",
            "testStrategy": "Para testar, pode-se alterar temporariamente as frequências para `everyMinute()`. Executar `php artisan schedule:run` e verificar (usando `tail -f storage/logs/laravel.log`) se os comandos são disparados e se os logs/arquivos correspondentes são gerados conforme o esperado.",
            "parentId": "undefined"
          },
          {
            "id": 7,
            "title": "Testar a Execução e Integração de Todos os Novos Comandos e Fluxos",
            "description": "Realizar um teste ponta-a-ponta para garantir que todos os comandos funcionam como esperado, que os logs são gerados corretamente, os backups são criados e rotacionados, as métricas são coletadas e as notificações são disparadas.",
            "dependencies": [
              2,
              6
            ],
            "details": "Executar cada comando manualmente (`db:backup`, `metrics:collect`, `credentials:notify-expiring`) e verificar os artefatos gerados. Simular uma ação de usuário para testar o `AuditMiddleware`. Executar `schedule:run` para testar o agendamento em conjunto.",
            "status": "pending",
            "testStrategy": "Seguir um roteiro de teste: 1. Fazer login e navegar para gerar logs de auditoria. 2. Executar `metrics:collect` e inspecionar o JSON. 3. Executar `db:backup` e verificar o arquivo SQL. 4. Executar `credentials:notify-expiring` e verificar o log de segurança. 5. Verificar se `schedule:run` aciona os comandos.",
            "parentId": "undefined"
          },
          {
            "id": 8,
            "title": "Documentar as Novas Rotinas de Manutenção e Monitoramento",
            "description": "Criar uma documentação no `README.md` ou em um wiki do projeto detalhando os novos comandos, o que eles fazem, como são agendados, a estrutura dos logs e onde encontrar os backups e métricas.",
            "dependencies": [
              7
            ],
            "details": "Descrever a finalidade de cada canal de log, a estrutura dos logs de auditoria e segurança. Explicar como executar manualmente os comandos (`db:backup`, `metrics:collect`) e como restaurar um backup. Listar a programação das tarefas configurada no Scheduler.",
            "status": "pending",
            "testStrategy": "Revisão por pares da documentação para garantir que ela seja clara, completa e útil para um novo desenvolvedor que se junte ao projeto ou para a equipe de operações responsável pela manutenção do sistema.",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": "8",
        "title": "Refatoração de Migrations, Seeders e Alinhamento de Schema/UI",
        "description": "Consolidar todas as migrations de banco de dados em uma sequência limpa, ajustar o modelo de dados para campos opcionais e strings não criptografadas, criar seeders robustos e alinhar o frontend do Filament para refletir as mudanças no backend.",
        "details": "1. **Backup e Limpeza de Migrations Antigas**: Antes de iniciar, faça um backup do banco de dados. Em seguida, remova todos os arquivos de migration existentes da pasta `database/migrations` para evitar conflitos. \n\n2. **Criação da Migration Consolidada**: Gere uma única migration que conterá a estrutura final de todas as tabelas. \n```bash\nvendor/bin/sail artisan make:migration create_consolidated_database_schema --create\n```\nNo arquivo gerado (ex: `2025_11_21_000000_create_consolidated_database_schema.php`), defina o schema completo para as tabelas `users`, `credentials`, `activity_log`, etc. Para a tabela `credentials`, ajuste os campos conforme especificado:\n```php\nSchema::create('credentials', function (Blueprint $table) {\n    $table->id();\n    $table->foreignId('user_id')->constrained()->onDelete('cascade');\n    $table->string('credential'); // Campo de string simples, não criptografado\n    $table->string('fscs');\n    $table->string('secrecy');\n    $table->date('concession')->nullable(); // Data de concessão opcional\n    $table->date('validity')->nullable(); // Data de validade opcional\n    $table->timestamps();\n    $table->softDeletes();\n});\n```\n\n3. **Ajuste no Model `Credential`**: Em `app/Models/Credential.php`, remova qualquer `Attribute` ou `Casts` que estivesse aplicando criptografia ao campo `credential`. Garanta que os campos de data estejam corretamente definidos no array `$casts`.\n```php\nprotected $casts = [\n    'concession' => 'date',\n    'validity' => 'date',\n    // Remova qualquer cast de criptografia para 'credential'\n];\n```\n\n4. **Criação de Seeders Robustos**: Modifique `database/seeders/DatabaseSeeder.php` para chamar os seeders específicos.\n```php\n// database/seeders/DatabaseSeeder.php\npublic function run(): void\n{\n    $this->call([\n        UserSeeder::class,\n        CredentialSeeder::class,\n    ]);\n}\n```\nCrie `UserSeeder.php` para popular usuários com diferentes roles (`super_admin`, `admin`, `user`). Crie `CredentialSeeder.php` para usar as factories e gerar credenciais com diferentes status: ativas, expiradas (`validity` no passado) e expirando em 30 dias (`validity` para `now()->addDays(29)`).\n\n5. **Alinhamento do Frontend Filament**: No arquivo `app/Filament/Resources/CredentialResource.php`, atualize o método `form()` para refletir o novo schema. Remova a diretiva `required()` dos campos `concession` e `validity`. Assegure que o campo `credential` seja um `TextInput` padrão, sem validações ou máscaras de criptografia.\n```php\n// app/Filament/Resources/CredentialResource.php\nuse Filament\\Forms\\Components\\DatePicker;\nuse Filament\\Forms\\Components\\TextInput;\n\npublic static function form(Form $form): Form\n{\n    return $form->schema([\n        TextInput::make('credential')->required(),\n        // ... outros campos\n        DatePicker::make('concession'), // Não é mais ->required()\n        DatePicker::make('validity'), // Não é mais ->required()\n    ]);\n}\n```\n\n6. **Documentação**: Após a conclusão e teste, gere um novo schema dump e atualize o `README.md` ou qualquer outra documentação relevante para descrever a nova estrutura do banco de dados.",
        "testStrategy": "1. **Execução da Nova Estrutura**: Rode o comando para recriar e popular o banco de dados do zero. Verifique se não ocorrem erros.\n```bash\nvendor/bin/sail artisan migrate:fresh --seed\n```\n\n2. **Verificação do Schema no Banco**: Conecte-se ao banco de dados (via Tinker ou cliente SQL) e inspecione a estrutura da tabela `credentials`. Confirme que as colunas `concession` e `validity` permitem valores nulos e que a coluna `credential` é do tipo `VARCHAR` (ou `string`).\n```bash\nvendor/bin/sail artisan tinker\n\\App\\Models\\Credential::first()->toArray();\n```\n\n3. **Verificação dos Dados Seeded**: Verifique se os seeders criaram os diferentes tipos de usuários e credenciais. Conte o número de usuários por role e o número de credenciais expiradas/ativas.\n```php\n// Em Tinker\nUser::whereHas('roles', fn($q) => $q->where('name', 'super_admin'))->count();\nCredential::where('validity', '<', now())->count();\n```\n\n4. **Teste de Regressão Completo**: Execute toda a suíte de testes (definida na Tarefa 5) para garantir que a refatoração não quebrou nenhuma funcionalidade existente, especialmente em relação à autenticação, autorização e manipulação de credenciais.\n```bash\nvendor/bin/sail artisan test\n```\n\n5. **Teste Manual da UI**: Navegue pelo painel Filament. Tente criar uma nova credencial deixando os campos de data em branco para confirmar que são opcionais. Edite uma credencial existente e verifique se o número da credencial é exibido como texto plano.",
        "status": "done",
        "dependencies": [
          "2",
          "3",
          "4",
          "5"
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "Backup do Banco de Dados e Limpeza das Migrations Antigas",
            "description": "Realizar um backup completo do banco de dados atual e, em seguida, remover todos os arquivos de migration existentes da pasta `database/migrations` para preparar o ambiente para a nova migration consolidada.",
            "dependencies": [],
            "details": "Use o cliente SQL de sua preferência para fazer um dump do banco de dados. Após a confirmação do backup, execute `rm database/migrations/*.php` no terminal para limpar a pasta de migrations. Esta é uma etapa destrutiva e preparatória.",
            "status": "done",
            "testStrategy": "Verificar se a pasta `database/migrations` está vazia, exceto talvez por um arquivo `.gitkeep`. Confirmar que o arquivo de backup do banco de dados foi criado com sucesso.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:13:06.362Z"
          },
          {
            "id": 2,
            "title": "Criação do Arquivo de Migration Consolidada",
            "description": "Gerar um único arquivo de migration que conterá a definição completa do schema para todas as tabelas do aplicativo, como `users`, `credentials`, e `activity_log`.",
            "dependencies": [
              1
            ],
            "details": "Execute o comando Artisan `php artisan make:migration create_consolidated_database_schema`. Isso criará um novo arquivo de migration na pasta `database/migrations` que servirá como a única fonte de verdade para a estrutura do banco de dados.",
            "status": "done",
            "testStrategy": "Verificar se um novo arquivo de migration, com um timestamp atual e o nome `create_consolidated_database_schema`, foi criado com sucesso na pasta `database/migrations`.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:13:33.797Z"
          },
          {
            "id": 3,
            "title": "Implementar Schema das Tabelas 'users' e 'password_reset_tokens' na Migration",
            "description": "Na nova migration consolidada, adicionar o código para criar as tabelas padrão do Laravel: `users` e `password_reset_tokens`.",
            "dependencies": [
              2
            ],
            "details": "No método `up()` do arquivo de migration gerado, adicione a criação da tabela `users` com colunas como `id`, `name`, `email`, `email_verified_at`, `password`, `remember_token` e `timestamps`. Em seguida, adicione a criação da tabela `password_reset_tokens`.",
            "status": "done",
            "testStrategy": "Executar `php artisan migrate` e verificar se as tabelas `users` e `password_reset_tokens` são criadas corretamente no banco de dados com as colunas esperadas.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:13:36.251Z"
          },
          {
            "id": 4,
            "title": "Implementar Novo Schema da Tabela 'credentials' na Migration",
            "description": "Adicionar a definição da tabela `credentials` na migration consolidada, ajustando os campos `credential` para string simples e `concession` e `validity` para datas opcionais (nullable).",
            "dependencies": [
              2
            ],
            "details": "Dentro do método `up()` da migration, adicione o `Schema::create('credentials', ...)` conforme especificado na tarefa. O campo `credential` deve ser `string`, não criptografado. Os campos `concession` e `validity` devem ter o método `->nullable()` aplicado.",
            "status": "done",
            "testStrategy": "Executar `php artisan migrate` e inspecionar a estrutura da tabela `credentials` no banco de dados para confirmar que o campo `credential` é do tipo `VARCHAR` e os campos `concession` e `validity` permitem valores nulos.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:13:38.639Z"
          },
          {
            "id": 5,
            "title": "Ajustar o Model 'Credential' para Remover Criptografia",
            "description": "Editar o arquivo `app/Models/Credential.php` para remover o cast de criptografia do atributo `credential` e garantir que os casts de data para `concession` e `validity` estejam corretos.",
            "dependencies": [
              4
            ],
            "details": "No arquivo `app/Models/Credential.php`, localize o array `$casts`. Remova a linha `'credential' => 'encrypted'` ou similar. Confirme que os casts `'concession' => 'date'` e `'validity' => 'date'` estão presentes para o correto manuseio dos campos de data pelo Eloquent.",
            "status": "done",
            "testStrategy": "Após popular o banco, usar `php artisan tinker` para criar e buscar uma instância de `Credential`. Verificar se o valor do atributo `credential` está em texto plano e não criptografado.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:14:05.402Z"
          },
          {
            "id": 6,
            "title": "Criar o 'UserSeeder' com Atribuição de Roles",
            "description": "Gerar e implementar um seeder para a tabela `users`, criando usuários com diferentes papéis (roles), como `super_admin`, `admin` e `user`.",
            "dependencies": [
              3
            ],
            "details": "Crie o seeder com `php artisan make:seeder UserSeeder`. No método `run()`, crie um usuário para cada role. Utilize a factory de User e, após a criação, use o método `assignRole()` do pacote `spatie/laravel-permission` para atribuir os papéis 'super_admin', 'admin', e 'user' a usuários distintos.",
            "status": "done",
            "testStrategy": "Executar `php artisan db:seed --class=UserSeeder`. Verificar a tabela `users` e `model_has_roles` para confirmar que os usuários foram criados e os papéis foram atribuídos corretamente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:14:38.644Z"
          },
          {
            "id": 7,
            "title": "Criar o 'CredentialSeeder' com Estados Variados",
            "description": "Gerar e implementar um seeder para a tabela `credentials`, populando-a com dados de teste que incluam credenciais ativas, expiradas e prestes a expirar.",
            "dependencies": [
              4,
              6
            ],
            "details": "Crie o seeder com `php artisan make:seeder CredentialSeeder`. Utilize a `CredentialFactory` para gerar dados. Na factory, adicione estados (states) para 'expired' (com `validity` no passado) e 'expiring_soon' (com `validity` para `now()->addDays(29)`). O seeder deve chamar esses estados para criar um conjunto de dados diversificado.",
            "status": "done",
            "testStrategy": "Executar `php artisan db:seed --class=CredentialSeeder`. Consultar a tabela `credentials` e verificar se existem registros com datas de validade no passado, no futuro próximo (29 dias) e no futuro distante.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:14:42.902Z"
          },
          {
            "id": 8,
            "title": "Configurar o 'DatabaseSeeder' Principal",
            "description": "Modificar o arquivo `database/seeders/DatabaseSeeder.php` para orquestrar a execução dos novos seeders (`UserSeeder` e `CredentialSeeder`) na ordem correta.",
            "dependencies": [
              6,
              7
            ],
            "details": "Abra o arquivo `database/seeders/DatabaseSeeder.php`. No método `run()`, substitua o conteúdo existente por uma chamada ao método `call()` com um array contendo as classes dos novos seeders: `[UserSeeder::class, CredentialSeeder::class]`.",
            "status": "done",
            "testStrategy": "Executar o comando `php artisan migrate:fresh --seed` completo. Verificar se as tabelas `users` e `credentials` são populadas com os dados definidos nos respectivos seeders, sem erros durante o processo.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:15:06.191Z"
          },
          {
            "id": 9,
            "title": "Alinhar Formulário do Filament em 'CredentialResource'",
            "description": "Atualizar o formulário de criação/edição no recurso `CredentialResource` para refletir o novo schema, tornando os campos de data opcionais e o campo de credencial um `TextInput` simples.",
            "dependencies": [
              5
            ],
            "details": "Edite o arquivo `app/Filament/Resources/CredentialResource.php`. No método `form()`, localize os componentes `DatePicker` para `concession` e `validity` e remova a chamada `->required()`. Altere o `TextInput` para `credential` para garantir que ele não use `->password()` ou qualquer outra máscara.",
            "status": "done",
            "testStrategy": "Navegar até a área administrativa do Filament, acessar o recurso de Credenciais e tentar criar um novo registro. Verificar se os campos de data não são mais obrigatórios e se o campo `credential` é um campo de texto normal.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:15:30.902Z"
          },
          {
            "id": 10,
            "title": "Gerar Novo Schema Dump e Atualizar Documentação",
            "description": "Após a implementação de todas as mudanças, gerar um novo dump do schema do banco de dados e atualizar o arquivo `README.md` ou outra documentação relevante para refletir a nova estrutura.",
            "dependencies": [
              8,
              9
            ],
            "details": "Execute o comando `php artisan schema:dump --prune` para gerar um arquivo `database/schema/mysql-schema.sql` atualizado. Em seguida, edite o `README.md` ou `database_schema.md` para descrever as mudanças na tabela `credentials` e a nova estrutura consolidada das migrations.",
            "status": "done",
            "testStrategy": "Revisar o arquivo de schema gerado para garantir que ele corresponda à estrutura criada pela migration consolidada. Ler a documentação atualizada para verificar se ela é clara e reflete com precisão o estado atual do projeto.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T03:19:14.314Z"
          }
        ],
        "updatedAt": "2025-11-21T03:19:14.314Z"
      },
      {
        "id": "9",
        "title": "Alinhamento Completo do CRUD de Credenciais com o Schema do Banco de Dados",
        "description": "Ajustar o recurso Filament `CredentialResource` para exibir e gerenciar todos os campos da tabela `credentials` (`fscs`, `name`, `secrecy`, `credential`, `concession`, `validity`, `user_id`), garantindo paridade total entre a interface do usuário e o banco de dados.",
        "details": "O objetivo desta tarefa é sincronizar completamente o `CredentialResource` do Filament com a estrutura da tabela `credentials` definida na Task #8. Isso envolve atualizar tanto o formulário de criação/edição quanto a tabela de listagem.\n\n1. **Atualizar o Formulário (`CredentialResource.php`, método `form`):**\n   - Adicione todos os campos que faltam ao schema do formulário. A estrutura deve ser semelhante a esta:\n   ```php\n   use Filament\\Forms\\Components\\TextInput;\n   use Filament\\Forms\\Components\\Select;\n   use Filament\\Forms\\Components\\DatePicker;\n\n   public static function form(Form $form): Form\n   {\n       return $form\n           ->schema([\n               TextInput::make('fscs')\n                   ->label('FSCS')\n                   ->required()\n                   ->maxLength(255),\n               TextInput::make('name')\n                   ->label('Nome da Credencial')\n                   ->required()\n                   ->maxLength(255),\n               Select::make('secrecy')\n                   ->label('Nível de Sigilo')\n                   ->options([\n                       'public' => 'Público',\n                       'internal' => 'Interno',\n                       'confidential' => 'Confidencial',\n                       'restricted' => 'Restrito'\n                   ])\n                   ->required(),\n               TextInput::make('credential')\n                   ->label('Credencial')\n                   ->password() // Para mascarar a entrada\n                   ->required(fn (string $context): bool => $context === 'create'), // Obrigatório apenas na criação\n               TextInput::make('concession')\n                   ->label('Concessão')\n                   ->nullable()\n                   ->maxLength(255),\n               DatePicker::make('validity')\n                   ->label('Validade')\n                   ->nullable(),\n               Select::make('user_id')\n                   ->label('Usuário Associado')\n                   ->relationship('user', 'name')\n                   ->searchable()\n                   ->required(),\n           ]);\n   }\n   ```\n\n2. **Atualizar a Tabela de Listagem (`CredentialResource.php`, método `table`):**\n   - Exiba todas as colunas relevantes na tabela de listagem, garantindo clareza e completude da informação.\n   - Utilize um `BadgeColumn` para o campo `secrecy`, preparando para usar o `BadgeColor` Enum da Task #4.\n   ```php\n   use Filament\\Tables\\Columns\\TextColumn;\n   use Filament\\Tables\\Columns\\BadgeColumn;\n\n   public static function table(Table $table): Table\n   {\n       return $table\n           ->columns([\n               TextColumn::make('id')->sortable(),\n               TextColumn::make('fscs')->label('FSCS')->searchable()->sortable(),\n               TextColumn::make('name')->label('Nome')->searchable()->sortable(),\n               BadgeColumn::make('secrecy')\n                   ->label('Sigilo')\n                   ->colors([\n                       'primary' => 'public',\n                       'warning' => 'internal',\n                       'success' => 'confidential', // Exemplo, alinhar com Enum da Task 4\n                       'danger' => 'restricted',\n                   ])->sortable(),\n               TextColumn::make('concession')->label('Concessão')->toggleable(isToggledHiddenByDefault: true),\n               TextColumn::make('validity')->label('Validade')->date('d/m/Y')->sortable(),\n               TextColumn::make('user.name')->label('Usuário')->searchable()->sortable(),\n               TextColumn::make('created_at')->label('Criado em')->dateTime('d/m/Y H:i')->sortable()->toggleable(isToggledHiddenByDefault: true),\n           ])\n           ->filters([/* ... */])\n           ->actions([/* ... */])\n           ->bulkActions([/* ... */]);\n   }\n   ```\n\n3. **Verificar Modelo `Credential.php`:**\n   - Confirme que a propriedade `$fillable` no modelo `App\\Models\\Credential` inclui todos os novos campos para permitir mass assignment: `['fscs', 'name', 'secrecy', 'credential', 'concession', 'validity', 'user_id']`.\n   - Garanta que a relação `user()` está corretamente definida: `public function user() { return $this->belongsTo(User::class); }`.",
        "testStrategy": "A estratégia de teste deve cobrir o fluxo completo de CRUD para garantir que todos os campos funcionem como esperado.\n\n1. **Teste de Criação:**\n   - Navegue para a página de criação de credenciais.\n   - Preencha todos os campos, incluindo os opcionais `concession` e `validity`.\n   - Salve o formulário e verifique se a credencial foi criada no banco de dados com todos os valores corretos.\n   - Crie uma segunda credencial, desta vez deixando os campos `concession` e `validity` vazios. Verifique se o registro foi salvo com valores `NULL` para esses campos.\n\n2. **Teste de Listagem e Visualização:**\n   - Na página de listagem, verifique se todas as novas colunas (`FSCS`, `Nome`, `Sigilo`, `Validade`, `Usuário`) estão visíveis e exibem os dados corretos para os registros criados.\n   - Utilize a funcionalidade de busca para pesquisar por `fscs`, `name` e `user.name`.\n   - Ordene a tabela por cada uma das novas colunas para garantir que a ordenação está funcionando.\n\n3. **Teste de Edição:**\n   - Abra um registro existente para edição.\n   - Verifique se todos os campos estão preenchidos com os dados corretos (o campo `credential` pode aparecer vazio por segurança, o que é esperado).\n   - Modifique o valor de cada campo, incluindo a alteração do `user_id` e a remoção de uma data de `validity`.\n   - Salve as alterações e confirme no banco de dados e na tela de listagem que os dados foram atualizados corretamente.\n\n4. **Teste de Visualização (se aplicável):**\n   - Se houver uma página de visualização, acesse-a e confirme que todos os campos da credencial são exibidos corretamente.",
        "status": "done",
        "dependencies": [
          "8"
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "Verificar e Atualizar o Modelo App\\Models\\Credential",
            "description": "Garantir que a propriedade `$fillable` no modelo `Credential` inclua todos os campos necessários para mass assignment e que a relação `belongsTo` com o modelo `User` esteja corretamente implementada.",
            "dependencies": [],
            "details": "Abra o arquivo `app/Models/Credential.php`. Verifique e atualize a propriedade `$fillable` para ser `['fscs', 'name', 'secrecy', 'credential', 'concession', 'validity', 'user_id']`. Adicione ou confirme que o método da relação `public function user() { return $this->belongsTo(User::class); }` existe e está correto.",
            "status": "done",
            "testStrategy": "Execute `php artisan tinker` e tente criar uma nova credencial usando `App\\Models\\Credential::create([...])` com todos os campos para confirmar que o mass assignment funciona sem lançar uma exceção.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:52:24.213Z"
          },
          {
            "id": 2,
            "title": "Implementar Formulário Completo de Credenciais no CredentialResource",
            "description": "Atualizar o método estático `form` em `app/Filament/Resources/CredentialResource.php` para incluir todos os campos do schema do banco de dados: `fscs`, `name`, `secrecy`, `credential`, `concession`, `validity` e `user_id`.",
            "dependencies": [
              1
            ],
            "details": "Substitua o conteúdo do método `public static function form(Form $form): Form` pelo código-exemplo fornecido na tarefa. Isso irá adicionar componentes como `TextInput`, `Select` com opções, `DatePicker` e um `Select` de relacionamento para o usuário.",
            "status": "done",
            "testStrategy": "Navegue até a página de criação/edição de uma credencial no painel Filament e verifique se todos os campos aparecem corretamente, com seus respectivos tipos (texto, senha, seletor, data) e validações, como o campo de senha ser obrigatório apenas na criação.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:52:26.512Z"
          },
          {
            "id": 3,
            "title": "Implementar Tabela de Listagem Completa no CredentialResource",
            "description": "Atualizar o método estático `table` em `app/Filament/Resources/CredentialResource.php` para exibir todas as colunas relevantes da tabela `credentials`, utilizando os componentes de coluna apropriados.",
            "dependencies": [
              1
            ],
            "details": "Substitua o conteúdo do método `public static function table(Table $table): Table` pelo código-exemplo da tarefa. Isso irá configurar colunas para `id`, `fscs`, `name`, `secrecy` (usando `BadgeColumn`), `concession`, `validity`, `user.name` e `created_at`, com funcionalidades de ordenação, busca e alternância de visibilidade.",
            "status": "done",
            "testStrategy": "Acesse a página de listagem de credenciais. Verifique se todas as colunas configuradas são exibidas e se a formatação (data, badge) está correta. Teste as funcionalidades de busca por nome e fscs, e a ordenação por diferentes colunas.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:52:28.574Z"
          },
          {
            "id": 4,
            "title": "Testar o Fluxo de Criação de uma Nova Credencial",
            "description": "Realizar um teste ponta a ponta do fluxo de criação de uma nova credencial através da interface do Filament para validar que todos os campos são salvos corretamente no banco de dados.",
            "dependencies": [
              2,
              3
            ],
            "details": "Acesse a funcionalidade 'Nova Credencial' no painel. Preencha todos os campos do formulário, incluindo os opcionais `concession` e `validity`. Submeta o formulário e verifique se o novo registro aparece na tabela de listagem com os dados corretos.",
            "status": "done",
            "testStrategy": "Após criar o registro pela UI, conecte-se ao banco de dados (via Tinker ou um cliente SQL) e inspecione o último registro na tabela `credentials` para confirmar que todos os valores foram persistidos exatamente como foram inseridos.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:52:30.832Z"
          },
          {
            "id": 5,
            "title": "Testar o Fluxo de Edição de uma Credencial Existente",
            "description": "Verificar se os dados de uma credencial existente são carregados corretamente no formulário de edição e se as modificações, incluindo a atualização opcional da senha, são salvas com sucesso.",
            "dependencies": [
              4
            ],
            "details": "Na listagem de credenciais, clique para editar o registro criado no passo anterior. Altere valores em campos como `name`, `secrecy` e `validity`. Salve o formulário e confirme que as alterações são refletidas na tabela. Teste salvar sem preencher o campo `credential` para garantir que a senha não seja alterada.",
            "status": "done",
            "testStrategy": "Verifique na interface e no banco de dados que os campos foram atualizados. Realize uma edição sem fornecer uma nova senha e tente fazer login (se aplicável) ou verifique o hash no banco para garantir que a senha antiga foi mantida.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:52:33.076Z"
          },
          {
            "id": 6,
            "title": "Testar a Exclusão da Credencial e a Visualização de Relacionamentos",
            "description": "Validar a funcionalidade de exclusão (soft delete ou hard delete) de uma credencial e confirmar que os dados de relacionamentos, como o nome do usuário, são exibidos corretamente na listagem e no formulário.",
            "dependencies": [
              5
            ],
            "details": "Na listagem de credenciais, utilize a ação de exclusão em um registro de teste. Confirme que o registro é removido da interface. Verifique se a coluna 'Usuário' na tabela e o campo 'Usuário Associado' no formulário exibem corretamente o nome do usuário, testando a relação Eloquent.",
            "status": "done",
            "testStrategy": "Confirme que a exclusão funciona e o registro desaparece da lista. Verifique se a busca pelo nome do usuário na listagem de credenciais filtra os resultados corretamente, validando a configuração `searchable()` na coluna do relacionamento.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:52:35.388Z"
          }
        ],
        "updatedAt": "2025-11-21T06:52:35.388Z"
      },
      {
        "id": "10",
        "title": "Implementação do Sistema de Postos e Graduações (Ranks)",
        "description": "Criar a estrutura de banco de dados e a lógica de aplicação para gerenciar Postos e Graduações, integrando-os ao modelo de Usuário e à interface do Filament.",
        "details": "Esta tarefa abrange a criação da tabela de postos/graduações, a modificação da tabela de usuários, a criação de modelos, seeders e a atualização da interface do Filament para refletir as mudanças. A base foi estabelecida na Task #8, e esta tarefa expande o modelo de dados do usuário.\n\n1. **Criar Migration e Model para Ranks**:\n   - Gere a migration para a tabela `ranks`.\n   ```bash\n   vendor/bin/sail artisan make:migration create_ranks_table\n   ```\n   - No arquivo da migration, defina o schema:\n   ```php\n   Schema::create('ranks', function (Blueprint $table) {\n       $table->id();\n       $table->string('force'); // Ex: 'Exército', 'Marinha', 'Aeronáutica'\n       $table->string('name'); // Ex: 'Soldado', 'Cabo'\n       $table->string('abbreviation'); // Ex: 'Sd', 'Cb'\n       $table->integer('order')->index(); // Para ordenação hierárquica\n       $table->timestamps();\n   });\n   ```\n\n2. **Alterar Tabela de Usuários**:\n   - Gere uma nova migration para adicionar os campos à tabela `users`.\n   ```bash\n   vendor/bin/sail artisan make:migration add_rank_fields_to_users_table\n   ```\n   - No arquivo da migration, adicione as colunas:\n   ```php\n   Schema::table('users', function (Blueprint $table) {\n       $table->string('full_name')->after('name');\n       $table->foreignId('rank_id')->nullable()->after('full_name')->constrained('ranks')->onDelete('set null');\n       $table->softDeletes();\n   });\n   ```\n\n3. **Criar Model e Relacionamentos**:\n   - Crie o model `Rank`:\n   ```bash\n   vendor/bin/sail artisan make:model Rank\n   ```\n   - Em `app/Models/Rank.php`, adicione o relacionamento:\n   ```php\n   public function users() { return $this->hasMany(User::class); }\n   ```\n   - Em `app/Models/User.php`, adicione o trait `SoftDeletes` e o relacionamento:\n   ```php\n   use Illuminate\\Database\\Eloquent\\SoftDeletes;\n   // ...\n   use SoftDeletes;\n   // ...\n   public function rank() { return $this->belongsTo(Rank::class); }\n   ```\n\n4. **Criar Seeder para Ranks**:\n   - Gere o seeder:\n   ```bash\n   vendor/bin/sail artisan make:seeder RankSeeder\n   ```\n   - Em `database/seeders/RankSeeder.php`, popule a tabela com os dados de `.taskmaster/docs/ranks.md`.\n   - Chame o `RankSeeder` em `database/seeders/DatabaseSeeder.php` ANTES do `UserSeeder`.\n\n5. **Atualizar `UserFactory` e `UserSeeder`**:\n   - Em `database/factories/UserFactory.php`, adicione `full_name` e um `rank_id` aleatório.\n   ```php\n   'full_name' => $this->faker->name(),\n   'rank_id' => \\App\\Models\\Rank::inRandomOrder()->first()->id,\n   ```\n   - Assegure que o `UserSeeder` utilize a factory atualizada.\n\n6. **Ajustar `UserResource` no Filament**:\n   - Em `app/Filament/Resources/UserResource.php`, atualize o formulário e a tabela.\n   - Método `form()`:\n   ```php\n   use Filament\\Forms\\Components\\TextInput;\n   use Filament\\Forms\\Components\\Select;\n   // ...\n   TextInput::make('full_name')->required(),\n   Select::make('rank_id')->relationship('rank', 'name')->searchable()->preload(),\n   ```\n   - Método `table()`:\n   ```php\n   use Filament\\Tables\\Columns\\TextColumn;\n   // ...\n   TextColumn::make('full_name')->searchable()->sortable(),\n   TextColumn::make('rank.name')->label('Posto/Grad')->searchable()->sortable(),\n   ```\n\n7. **Atualizar Documentação**:\n   - Edite o arquivo `database_schema.md` para incluir a estrutura da nova tabela `ranks` e as colunas adicionadas à tabela `users`.",
        "testStrategy": "1. **Teste de Migração e População**:\n   - Execute o comando para recriar o banco de dados do zero.\n   ```bash\n   vendor/bin/sail artisan migrate:fresh --seed\n   ```\n   - Verifique se o processo é concluído sem erros.\n\n2. **Verificação no Banco de Dados via Tinker**:\n   - Confirme se a tabela `ranks` foi populada: `\\App\\Models\\Rank::count();` (deve ser > 0).\n   - Verifique se os usuários foram associados a um rank: `\\App\\Models\\User::first()->rank->name;` (deve retornar um nome de posto/graduação).\n   - Confirme se `full_name` foi preenchido: `\\App\\Models\\User::first()->full_name;` (deve retornar um nome).\n\n3. **Teste da Interface do Filament (CRUD de Usuário)**:\n   - **Listagem**: Acesse a lista de usuários e verifique se as colunas 'Nome Completo' e 'Posto/Grad' são exibidas corretamente.\n   - **Criação**: Crie um novo usuário. Verifique se o campo de seleção de Posto/Graduação está populado e se o nome completo pode ser salvo.\n   - **Edição**: Edite um usuário existente. Altere seu Posto/Graduação e seu nome completo e salve. Verifique se a alteração foi persistida.\n   - **Exclusão**: Exclua um usuário pela interface.\n\n4. **Teste de Soft Delete**:\n   - Após excluir um usuário no passo anterior, verifique no Tinker que o registro ainda existe no banco com `deleted_at` preenchido.\n   ```php\n   // Substitua 1 pelo ID do usuário deletado\n   \\App\\Models\\User::withTrashed()->find(1);\n   ```\n   - Confirme que o mesmo usuário não é encontrado sem `withTrashed()`:\n   ```php\n   \\App\\Models\\User::find(1); // Deve retornar null\n   ```\n\n5. **Validação da Documentação**:\n   - Abra o arquivo `database_schema.md` e confirme que a descrição das tabelas `users` e `ranks` está atualizada e correta.",
        "status": "done",
        "dependencies": [
          "1",
          "8",
          "9"
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "Criar Migration para Tabela de Postos/Graduações (`ranks`)",
            "description": "Gerar e configurar o arquivo de migration para a criação da tabela `ranks`, que armazenará as informações hierárquicas de postos e graduações.",
            "dependencies": [],
            "details": "Executar o comando `vendor/bin/sail artisan make:migration create_ranks_table`. No arquivo de migration, definir o schema com as colunas: `id`, `force` (string), `name` (string), `abbreviation` (string), `order` (integer com índice) e `timestamps`.",
            "status": "done",
            "testStrategy": "Verificar se o arquivo de migration é criado no diretório `database/migrations`. Inspecionar o código gerado para garantir que o schema da tabela `ranks` está definido corretamente conforme a especificação.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:36:07.315Z"
          },
          {
            "id": 2,
            "title": "Criar Migration para Adicionar Campos na Tabela `users`",
            "description": "Gerar uma nova migration para adicionar as colunas `full_name`, `rank_id` (com chave estrangeira para `ranks`) e suporte a `SoftDeletes` na tabela de usuários existente.",
            "dependencies": [
              1
            ],
            "details": "Executar `vendor/bin/sail artisan make:migration add_rank_fields_to_users_table`. No schema, adicionar `$table->string('full_name')->after('name');`, `$table->foreignId('rank_id')->nullable()->after('full_name')->constrained('ranks')->onDelete('set null');` e `$table->softDeletes();`.",
            "status": "done",
            "testStrategy": "Inspecionar o arquivo da nova migration para confirmar que as colunas `full_name`, `rank_id` e `deleted_at` serão corretamente adicionadas à tabela `users`.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:36:10.855Z"
          },
          {
            "id": 3,
            "title": "Criar Model `Rank` e Definir Relacionamentos",
            "description": "Gerar o model `Rank` e configurar os relacionamentos Eloquent necessários entre `User` e `Rank`.",
            "dependencies": [
              1,
              2
            ],
            "details": "Executar `vendor/bin/sail artisan make:model Rank`. Em `app/Models/Rank.php`, adicionar o relacionamento `public function users() { return $this->hasMany(User::class); }`. Em `app/Models/User.php`, adicionar o trait `use SoftDeletes;` e o relacionamento `public function rank() { return $this->belongsTo(Rank::class); }`.",
            "status": "done",
            "testStrategy": "Revisar os arquivos `app/Models/User.php` e `app/Models/Rank.php` para garantir que os relacionamentos `belongsTo` e `hasMany`, assim como o trait `SoftDeletes`, foram implementados corretamente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:36:38.177Z"
          },
          {
            "id": 4,
            "title": "Criar Seeder para Popular a Tabela de Postos e Graduações (`RankSeeder`)",
            "description": "Gerar um seeder para preencher a tabela `ranks` com os dados hierárquicos de postos e graduações das diferentes forças, conforme a documentação do projeto.",
            "dependencies": [
              1,
              3
            ],
            "details": "Executar `vendor/bin/sail artisan make:seeder RankSeeder`. No método `run()`, implementar a lógica para inserir os registros de postos e graduações, utilizando os dados de `.taskmaster/docs/ranks.md` como referência.",
            "status": "done",
            "testStrategy": "Após a execução da migration da tabela `ranks`, executar o seeder isoladamente com `php artisan db:seed --class=RankSeeder` e verificar no banco de dados se a tabela `ranks` foi populada corretamente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:37:13.363Z"
          },
          {
            "id": 5,
            "title": "Integrar `RankSeeder` no Processo de Seed Principal",
            "description": "Garantir que o `RankSeeder` seja executado durante o processo de `db:seed`, chamando-o na ordem correta dentro do `DatabaseSeeder` para evitar erros de chave estrangeira.",
            "dependencies": [
              4
            ],
            "details": "Editar o arquivo `database/seeders/DatabaseSeeder.php` e adicionar a chamada `$this->call(RankSeeder::class);` antes da chamada ao `UserSeeder` existente.",
            "status": "done",
            "testStrategy": "Executar o comando completo `vendor/bin/sail artisan migrate:fresh --seed` e verificar se o processo é concluído sem erros, indicando que a ordem de execução dos seeders está correta.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:37:25.870Z"
          },
          {
            "id": 6,
            "title": "Atualizar `UserFactory` com `full_name` e `rank_id`",
            "description": "Modificar a `UserFactory` para que os usuários gerados para testes e seeding tenham um nome completo (`full_name`) e um `rank_id` aleatório e válido, obtido da tabela `ranks`.",
            "dependencies": [
              3,
              5
            ],
            "details": "Em `database/factories/UserFactory.php`, adicionar `'full_name' => $this->faker->name()` e `'rank_id' => \\App\\Models\\Rank::inRandomOrder()->first()->id` na definição da factory.",
            "status": "done",
            "testStrategy": "Utilizar o Tinker para criar um novo usuário via factory (`\\App\\Models\\User::factory()->create();`) e verificar se os campos `full_name` e `rank_id` foram preenchidos corretamente no registro do banco de dados.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:37:41.790Z"
          },
          {
            "id": 7,
            "title": "Atualizar Formulário do `UserResource` no Filament",
            "description": "Modificar o método `form()` do `UserResource` para permitir a criação e edição dos campos `full_name` e `rank_id` na interface do Filament.",
            "dependencies": [
              3
            ],
            "details": "Em `app/Filament/Resources/UserResource.php`, dentro do método `form()`, adicionar um `TextInput` para `full_name` e um `Select` para `rank_id` utilizando `relationship('rank', 'name')` com as opções `searchable()` e `preload()`.",
            "status": "done",
            "testStrategy": "Acessar a página de criação ou edição de um usuário no painel Filament e confirmar que os campos 'Nome Completo' e 'Posto/Graduação' (com a lista de ranks) estão presentes e funcionais.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:38:20.021Z"
          },
          {
            "id": 8,
            "title": "Atualizar Tabela do `UserResource` no Filament",
            "description": "Modificar o método `table()` do `UserResource` para exibir as colunas `full_name` e o nome do posto/graduação (`rank.name`) na listagem de usuários do Filament.",
            "dependencies": [
              3
            ],
            "details": "Em `app/Filament/Resources/UserResource.php`, dentro do método `table()`, adicionar `TextColumn` para `full_name` e `rank.name` (com `label('Posto/Grad')`). Ambos devem ser configurados com `searchable()` e `sortable()`.",
            "status": "done",
            "testStrategy": "Acessar a página de listagem de usuários no painel Filament e verificar se as colunas 'Nome Completo' e 'Posto/Grad' são exibidas com os dados corretos e se as funcionalidades de busca e ordenação funcionam.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:38:21.753Z"
          },
          {
            "id": 9,
            "title": "Atualizar Documentação do Schema do Banco de Dados",
            "description": "Editar o arquivo `database_schema.md` para incluir a estrutura da nova tabela `ranks` e documentar as colunas adicionadas à tabela `users`.",
            "dependencies": [
              1,
              2
            ],
            "details": "No arquivo `database_schema.md`, adicionar uma nova seção descrevendo a tabela `ranks` e seus campos. Atualizar a seção da tabela `users` para incluir os campos `full_name`, `rank_id` e `deleted_at`.",
            "status": "done",
            "testStrategy": "Revisar o arquivo `database_schema.md` após a edição para garantir que a documentação reflete com precisão as alterações implementadas no banco de dados.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:43:28.004Z"
          },
          {
            "id": 10,
            "title": "Executar Migrations e Seeders para Validar Integração Completa",
            "description": "Executar o comando `migrate:fresh --seed` para recriar o banco de dados com todas as novas estruturas e dados, garantindo que todo o processo de implementação funcione de ponta a ponta.",
            "dependencies": [
              5,
              6,
              7,
              8
            ],
            "details": "No terminal, dentro do ambiente do projeto, executar o comando `vendor/bin/sail artisan migrate:fresh --seed`. Este comando irá apagar todas as tabelas, executar todas as migrations e popular o banco de dados com todos os seeders configurados.",
            "status": "done",
            "testStrategy": "Confirmar que o comando `migrate:fresh --seed` é executado com sucesso sem nenhum erro. Após a execução, acessar o painel Filament e verificar se os dados de usuários e postos/graduações estão sendo exibidos corretamente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T04:43:30.210Z"
          }
        ],
        "updatedAt": "2025-11-21T04:43:30.210Z"
      },
      {
        "id": "11",
        "title": "Implementação do Sistema de Unidades Militares (Offices)",
        "description": "Criar a estrutura de banco de dados e a lógica de aplicação para gerenciar Unidades Militares (Offices), integrando-as ao modelo de Usuário e à interface do Filament, de forma análoga ao sistema de Postos/Graduações.",
        "details": "Esta tarefa espelha a implementação do sistema de Ranks (Tarefa #10), criando uma nova entidade 'Office' e associando-a aos usuários. A base para modificações no schema foi estabelecida na Tarefa #8.\n\n1. **Criar Migration e Model para Offices**:\n   - Gere a migration para a tabela `offices`.\n   ```bash\n   vendor/bin/sail artisan make:model Office -m\n   ```\n   - No arquivo da migration, defina o schema:\n   ```php\n   Schema::create('offices', function (Blueprint $table) {\n       $table->id();\n       $table->string('office')->unique(); // Sigla, ex: GAC-PAC\n       $table->string('description'); // Nome completo, ex: Gabinete de Apoio à Coordenação\n       $table->timestamps();\n   });\n   ```\n   - No model `App\\Models\\Office.php`, defina os campos preenchíveis e a relação:\n   ```php\n   protected $fillable = ['office', 'description'];\n\n   public function users(): HasMany\n   {\n       return $this->hasMany(User::class);\n   }\n   ```\n\n2. **Adicionar Relacionamento na Tabela `users`**:\n   - Crie uma nova migration para adicionar a coluna `office_id`.\n   ```bash\n   vendor/bin/sail artisan make:migration add_office_id_to_users_table\n   ```\n   - Defina a chave estrangeira, posicionando-a após `rank_id` para manter a organização.\n   ```php\n   Schema::table('users', function (Blueprint $table) {\n       $table->foreignId('office_id')->nullable()->after('rank_id')->constrained('offices')->onDelete('set null');\n   });\n   ```\n\n3. **Atualizar Model `User`**:\n   - Adicione o relacionamento `belongsTo` em `App\\Models\\User.php`.\n   ```php\n   public function office(): BelongsTo\n   {\n       return $this->belongsTo(Office::class);\n   }\n   ```\n\n4. **Criar Seeder para Offices**:\n   - Gere o seeder.\n   ```bash\n   vendor/bin/sail artisan make:seeder OfficeSeeder\n   ```\n   - Popule com as unidades especificadas:\n   ```php\n   use App\\Models\\Office;\n\n   $offices = [\n       ['office' => 'GAC-PAC', 'description' => 'Gabinete de Apoio à Coordenação'],\n       ['office' => 'SCP-EMB', 'description' => 'Seção de Coordenação de Projetos Especiais'],\n       ['office' => 'ECP-GPX', 'description' => 'Escritório de Coordenação de Projetos de Gestão'],\n       ['office' => 'ECP-IJA', 'description' => 'Escritório de Coordenação de Projetos de Infraestrutura'],\n       ['office' => 'ECP-POA', 'description' => 'Escritório de Coordenação de Projetos de Portfólio'],\n   ];\n   foreach ($offices as $office) {\n       Office::create($office);\n   }\n   ```\n\n5. **Atualizar Seeders e Factories de Usuário**:\n   - Em `DatabaseSeeder.php`, chame o `OfficeSeeder::class`.\n   - Em `UserFactory.php`, atribua um `office_id` aleatório aos novos usuários.\n   ```php\n   'office_id' => \\App\\Models\\Office::inRandomOrder()->first()->id,\n   ```\n\n6. **Ajustar `UserResource` no Filament**:\n   - Em `app/Filament/Resources/UserResource.php`, atualize a tabela e o formulário.\n   - No método `table()`:\n   ```php\n   Tables\\Columns\\TextColumn::make('office.office')->label('Unidade')->sortable()->searchable(),\n   ```\n   - No método `form()`:\n   ```php\n   Forms\\Components\\Select::make('office_id')\n       ->relationship('office', 'office')\n       ->searchable()\n       ->preload()\n       ->label('Unidade'),\n   ```\n\n7. **Atualizar Documentação**:\n   - Edite o arquivo `database_schema.md` para incluir a nova tabela `offices` e o campo `office_id` na tabela `users`.",
        "testStrategy": "1. **Teste de Migração e População**:\n   - Execute o comando para recriar e popular o banco de dados do zero. Verifique se não ocorrem erros.\n   ```bash\n   vendor/bin/sail artisan migrate:fresh --seed\n   ```\n\n2. **Verificação no Banco de Dados via Tinker**:\n   - Confirme se a tabela `offices` foi criada e populada.\n   ```bash\n   vendor/bin/sail artisan tinker\n   >>> \\App\\Models\\Office::count(); // Deve retornar 5\n   >>> \\App\\Models\\Office::where('office', 'GAC-PAC')->exists(); // Deve retornar true\n   ```\n   - Verifique se os usuários foram associados a uma unidade.\n   ```bash\n   >>> $user = \\App\\Models\\User::first();\n   >>> isset($user->office_id); // Deve retornar true\n   >>> $user->office->description; // Deve retornar o nome completo da unidade\n   ```\n\n3. **Verificação na Interface do Filament**:\n   - Acesse o painel de administração e navegue até a seção de Usuários.\n   - **Listagem**: Confirme que a coluna 'Unidade' aparece na tabela e exibe a sigla da unidade de cada usuário.\n   - **Criação/Edição**: Abra o formulário para criar ou editar um usuário. Verifique se o campo do tipo dropdown 'Unidade' está presente, populado com as 5 unidades, e permite a seleção e salvamento da associação.",
        "status": "done",
        "dependencies": [
          "1",
          "8",
          "10"
        ],
        "priority": "high",
        "subtasks": [],
        "updatedAt": "2025-11-21T05:15:03.335Z"
      },
      {
        "id": "12",
        "title": "Refatoração Abrangente do Sistema de Credenciais com Novas Regras de Negócio",
        "description": "Refatorar a entidade Credential, ajustando o schema do banco de dados, implementando novas regras de negócio para tipo e validade, e atualizando a interface Filament, validadores e testes para refletir as mudanças.",
        "details": "Esta tarefa envolve uma refatoração completa do módulo de credenciais, desde o banco de dados até a interface do usuário, para alinhar com as novas regras de negócio. As mudanças impactam o schema, a lógica de modelo, o recurso Filament e os testes.\n\n1. **Criar Nova Migration para Alterações no Schema**:\n   - Crie uma nova migration para modificar a tabela `credentials`.\n   ```bash\n   vendor/bin/sail artisan make:migration refactor_credentials_table --table=credentials\n   ```\n   - No método `up` da migration, aplique as seguintes alterações:\n   ```php\n   Schema::table('credentials', function (Blueprint $table) {\n       $table->renameColumn('name', 'type');\n       $table->text('observation')->nullable()->after('credential');\n       $table->string('secrecy')->comment('Valores permitidos: R, S')->change();\n   });\n   Schema::table('credentials', function (Blueprint $table) {\n       $table->foreignId('user_id')->nullable(false)->change();\n       $table->string('type')->nullable(false)->change();\n       $table->string('secrecy')->nullable(false)->change();\n   });\n   ```\n\n2. **Atualizar Model e Lógica de Negócio (`app/Models/Credential.php`)**:\n   - Crie Enums para `type` e `secrecy` para maior robustez:\n     `app/Enums/CredentialType.php` (com casos CRED e TCMS)\n     `app/Enums/CredentialSecrecy.php` (com casos R e S)\n   - Atualize os `$casts` no modelo:\n     `'type' => CredentialType::class,`\n     `'secrecy' => CredentialSecrecy::class,`\n   - Implemente um `CredentialObserver` para calcular a validade automaticamente. Registre-o no `AppServiceProvider`.\n   ```php\n   // app/Observers/CredentialObserver.php\n   public function saving(Credential $credential): void\n   {\n       if ($credential->isDirty('concession') && $credential->concession) {\n           if ($credential->type === CredentialType::CRED) {\n               $credential->validity = $credential->concession->addYears(2);\n           } elseif ($credential->type === CredentialType::TCMS) {\n               $credential->validity = $credential->concession->endOfYear();\n           }\n       }\n   }\n   ```\n   - Implemente o accessor `getStatusAttribute`:\n   ```php\n   // app/Models/Credential.php\n   use Illuminate\\Database\\Eloquent\\Casts\\Attribute;\n   use Carbon\\Carbon;\n\n   protected function status(): Attribute\n   {\n       return Attribute::make(\n           get: function () {\n               if ($this->fscs === '00000') return 'Negada';\n               if ($this->validity && $this->validity < Carbon::today()) return 'Vencida';\n               if ($this->fscs && $this->type === CredentialType::TCMS) return 'Em Processamento';\n               if ($this->fscs && $this->type === CredentialType::CRED && !$this->concession) return 'Pendente';\n               if ($this->fscs && $this->type === CredentialType::CRED && $this->concession) return 'Ativa';\n               return 'Desconhecido';\n           }\n       );\n   }\n   ```\n\n3. **Atualizar `CredentialResource` do Filament**:\n   - **Formulário (`form()`):**\n     - Substitua `TextInput` para 'name' por `Select` para 'type', usando o Enum `CredentialType` como opções.\n     - Adicione um `Textarea` para o campo `observation`.\n     - Atualize o `Select` de `secrecy` para usar o Enum `CredentialSecrecy` e remova a opção 'O'.\n     - Adicione `->required()` nos campos `type`, `secrecy` e `user_id`.\n   - **Tabela (`table()`):**\n     - Renomeie a coluna 'name' para 'type'.\n     - Adicione uma `BadgeColumn` para o status, utilizando a lógica do accessor e o `BadgeColor` Enum da Tarefa #4.\n     ```php\n     BadgeColumn::make('status')\n         ->colors([\n             'secondary' => 'Negada',\n             'danger' => 'Vencida',\n             'primary' => 'Em Processamento',\n             'warning' => 'Pendente',\n             'success' => 'Ativa',\n         ])->sortable(),\n     ```\n   - **Filtros:** Adicione um `SelectFilter` para o status, permitindo filtrar a tabela pelos valores possíveis do accessor 'status'.\n\n4. **Atualizar `CredentialFactory` e Seeders**:\n   - Modifique `database/factories/CredentialFactory.php` para refletir o novo schema: renomeie `name` para `type`, adicione `observation`, e garanta que os valores padrão para `type` e `secrecy` sejam válidos. Remova a nulabilidade de `user_id`.",
        "testStrategy": "1. **Teste de Migração e Seeding**:\n   - Execute `vendor/bin/sail artisan migrate:fresh --seed` e verifique se o processo é concluído sem erros. Confirme as alterações no schema do banco de dados (nomes de colunas, tipos, constraints NOT NULL).\n\n2. **Testes Unitários e de Feature**:\n   - Crie um teste para o `CredentialObserver` ou evento de modelo para garantir que o campo `validity` seja calculado corretamente para os tipos 'CRED' e 'TCMS' ao salvar uma credencial com data de concessão.\n   - Crie testes específicos para o accessor `getStatusAttribute()`. Para cada um dos 5 estados (Negada, Vencida, Em Processamento, Pendente, Ativa), crie uma credencial com os atributos necessários no teste, chame o accessor e verifique se a string de status retornada é a correta.\n\n3. **Testes de Interface com Pest/Livewire**:\n   - **Formulário**: Verifique se o formulário de criação/edição de credencial exibe um `Select` para 'Tipo' com as opções 'CRED' e 'TCMS', e que a submissão falha se campos obrigatórios (`type`, `secrecy`, `user_id`) não forem preenchidos.\n   - **Tabela**: Verifique se a listagem de credenciais exibe a coluna 'Status' com o `BadgeColumn` colorido corretamente para diferentes credenciais em cada um dos estados possíveis.\n   - **Filtro**: Teste o novo filtro de 'Status'. Aplique o filtro para 'Ativa', por exemplo, e verifique se a tabela exibe apenas as credenciais ativas.\n\n4. **Revisão de Testes Existentes**:\n   - Procure por testes que possam ter sido quebrados pela renomeação da coluna `name` para `type` e atualize-os conforme necessário.",
        "status": "done",
        "dependencies": [
          "4",
          "8",
          "9"
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "Criar Migration para Alterar Schema de 'credentials'",
            "description": "Gerar e implementar uma nova migration para modificar a tabela 'credentials', renomeando a coluna 'name' para 'type', adicionando a coluna 'observation' e ajustando constraints de nulidade e tipo.",
            "dependencies": [],
            "details": "Use o comando `vendor/bin/sail artisan make:migration refactor_credentials_table --table=credentials`. No método `up`, aplique as alterações de schema, incluindo a renomeação de `name` para `type` e a adição das constraints `NOT NULL`.",
            "status": "done",
            "testStrategy": "Execute `php artisan migrate` em um ambiente de desenvolvimento e inspecione o schema da tabela 'credentials' no banco de dados para confirmar que a coluna foi renomeada, a nova coluna foi adicionada e as constraints de não nulidade foram aplicadas corretamente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T05:43:48.645Z"
          },
          {
            "id": 2,
            "title": "Criar Enums para CredentialType e CredentialSecrecy",
            "description": "Desenvolver Enums para os campos 'type' e 'secrecy' para garantir type safety e centralizar os valores permitidos (CRED/TCMS para tipo e R/S para sigilo), melhorando a robustez do código.",
            "dependencies": [],
            "details": "Crie os arquivos `app/Enums/CredentialType.php` e `app/Enums/CredentialSecrecy.php`. Implemente-os como Backed Enums com os respectivos casos: `CRED = 'CRED'`, `TCMS = 'TCMS'` e `R = 'R'`, `S = 'S'`.",
            "status": "done",
            "testStrategy": "Verifique a existência e o conteúdo dos arquivos de Enum. Use o `php artisan tinker` para instanciar os enums e confirmar que os casos e valores (`->value`) estão corretos.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T05:44:03.085Z"
          },
          {
            "id": 3,
            "title": "Implementar CredentialObserver para Cálculo Automático da Validade",
            "description": "Criar um Observer para o modelo Credential que, no evento 'saving', calcula e define automaticamente o campo 'validity' com base no tipo da credencial e na data de concessão, aplicando as novas regras de negócio.",
            "dependencies": [
              2
            ],
            "details": "Crie `app/Observers/CredentialObserver.php`. No método `saving`, verifique se o campo `concession` foi alterado e aplique a lógica de cálculo da validade (+2 anos para CRED, fim do ano para TCMS). Registre o Observer no `AppServiceProvider`.",
            "status": "done",
            "testStrategy": "Crie um teste de feature que salva uma credencial de cada tipo (CRED e TCMS). Verifique se, ao definir uma data de `concession`, o campo `validity` é preenchido automaticamente com o valor correto conforme a regra de negócio.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T05:44:25.243Z"
          },
          {
            "id": 4,
            "title": "Atualizar Modelo Credential com Casts e Accessor de Status",
            "description": "Modificar o modelo `app/Models/Credential.php` para utilizar os novos Enums nos casts dos campos 'type' e 'secrecy' e implementar um accessor 'status' para derivar o estado da credencial (Negada, Vencida, Ativa, etc.).",
            "dependencies": [
              2
            ],
            "details": "No modelo `Credential`, atualize a propriedade `$casts` para usar `CredentialType::class` e `CredentialSecrecy::class`. Implemente o accessor `status()` usando `Attribute::make()` com a lógica de status detalhada.",
            "status": "done",
            "testStrategy": "Crie um teste unitário para o modelo `Credential`. Crie instâncias do modelo com diferentes atributos e verifique se o accessor `status` retorna a string correta para cada cenário (Vencida, Ativa, Pendente, etc.).",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T05:44:48.035Z"
          },
          {
            "id": 5,
            "title": "Atualizar CredentialFactory para o Novo Schema",
            "description": "Ajustar a factory de Credential para refletir as alterações do schema, renomeando 'name' para 'type', adicionando 'observation' e garantindo que os valores gerados sejam válidos e não nulos para os campos requeridos.",
            "dependencies": [
              1,
              2
            ],
            "details": "Em `database/factories/CredentialFactory.php`, renomeie a chave `name` para `type` e use um valor do Enum `CredentialType`. Adicione um valor para `observation` e garanta que `user_id` seja sempre preenchido.",
            "status": "done",
            "testStrategy": "Execute `Credential::factory()->create()` no tinker ou em um teste. Confirme que o registro é criado no banco de dados sem erros e que todos os campos estão populados conforme a nova estrutura.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T05:45:23.543Z"
          },
          {
            "id": 6,
            "title": "Atualizar Formulário do CredentialResource no Filament",
            "description": "Refatorar o formulário no `CredentialResource` para alinhar com o novo schema: substituir o campo 'name' por um seletor 'type', adicionar um campo para 'observation', atualizar o seletor 'secrecy' e adicionar validação de obrigatoriedade.",
            "dependencies": [
              2,
              4
            ],
            "details": "No método `form()` do `CredentialResource`, troque `TextInput` para 'name' por `Select` para 'type' usando `CredentialType::class`. Adicione `Textarea` para 'observation' e ajuste o `Select` de `secrecy`. Aplique `->required()` nos campos pertinentes.",
            "status": "done",
            "testStrategy": "Navegue até a página de criação/edição de uma credencial na UI. Verifique se os campos do formulário refletem as mudanças: 'Tipo' como um select, 'Observação' como textarea e se a validação de campos obrigatórios funciona ao tentar salvar.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T05:45:51.036Z"
          },
          {
            "id": 7,
            "title": "Atualizar Tabela do CredentialResource com Coluna de Status",
            "description": "Ajustar a listagem de credenciais no `CredentialResource` para renomear a coluna 'name' para 'type' e adicionar uma `BadgeColumn` para exibir o status derivado, com cores distintas para cada estado.",
            "dependencies": [
              4
            ],
            "details": "No método `table()` do `CredentialResource`, renomeie a coluna `name` para `type`. Adicione uma `BadgeColumn::make('status')` e configure o método `->colors()` com os pares de cor/estado apropriados (ex: 'success' => 'Ativa').",
            "status": "done",
            "testStrategy": "Acesse a listagem de credenciais. Verifique se a coluna 'Status' é exibida com badges coloridos que correspondem corretamente ao estado de cada registro na tabela.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T05:46:21.820Z"
          },
          {
            "id": 8,
            "title": "Adicionar Filtro de Status na Tabela do CredentialResource",
            "description": "Implementar um `SelectFilter` na tabela do `CredentialResource` para permitir que os usuários filtrem a lista de credenciais pelo novo campo de status (Ativa, Vencida, Pendente, etc.).",
            "dependencies": [
              7
            ],
            "details": "No método `table()`, na seção `filters()`, adicione um `SelectFilter::make('status')` com as opções correspondentes aos valores retornados pelo accessor de status do modelo.",
            "status": "done",
            "testStrategy": "Na interface de listagem, utilize o novo filtro de status. Selecione cada uma das opções e confirme que a tabela é filtrada para exibir apenas os registros que correspondem ao status selecionado.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T05:46:40.019Z"
          },
          {
            "id": 9,
            "title": "Atualizar Testes Quebrados e Criar Novos",
            "description": "Revisar e corrigir toda a suíte de testes que foi quebrada pelas mudanças no schema e na lógica de negócio. Criar novos testes para cobrir as novas funcionalidades, como o cálculo da validade pelo Observer e os estados de status.",
            "dependencies": [
              1,
              2,
              3,
              4,
              5,
              6,
              7,
              8
            ],
            "details": "Execute `vendor/bin/sail test`, identifique todas as falhas e ajuste os testes para o novo schema e lógica. Crie novos testes de feature para o `CredentialObserver` e testes unitários para o accessor `status` do modelo `Credential`.",
            "status": "done",
            "testStrategy": "Execute a suíte de testes completa (`vendor/bin/sail test`). O objetivo é alcançar 100% de aprovação. Verifique o relatório de cobertura de código para garantir que a nova lógica de negócio está adequadamente coberta.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T05:50:04.165Z"
          }
        ],
        "complexity": 9,
        "recommendedSubtasks": 9,
        "expansionPrompt": "Decompor em: (1) Criar migration para alterar schema de `credentials` (renomear, adicionar colunas, constraints); (2) Criar Enums para `CredentialType` e `CredentialSecrecy`; (3) Implementar `CredentialObserver` para calcular `validity`; (4) Atualizar model `Credential` com casts e accessor `status`; (5) Atualizar `CredentialFactory`; (6) Atualizar formulário do `CredentialResource` (Selects, Textarea, required); (7) Atualizar tabela do `CredentialResource` (BadgeColumn para status); (8) Adicionar `SelectFilter` para o novo status; (9) Atualizar todos os testes quebrados e criar novos para as novas lógicas.",
        "updatedAt": "2025-11-21T05:50:04.165Z"
      },
      {
        "id": "13",
        "title": "Criação do Dashboard Personalizado com Card de Credencial",
        "description": "Desenvolver uma página inicial de dashboard que exibe um card com os dados da credencial do usuário logado e renomear o item de menu correspondente na sidebar para 'Dashboard'.",
        "details": "Esta tarefa consiste em duas partes principais: ajustar a navegação do Filament e criar uma página de dashboard personalizada que sirva como a página inicial após o login.\n\n1. **Ajuste da Sidebar e Rota Principal:**\n   - No arquivo `app/Providers/Filament/AdminPanelProvider.php`, localize o método `navigation()` ou o grupo de navegação principal.\n   - Renomeie o item de menu de 'Painel de Controle' para 'Dashboard'.\n   - Configure a nova página de dashboard para ser a rota padrão do painel, modificando a propriedade `path('/')` e `pages([\n        PagesDashboard::class,\n    ])`.\n\n2. **Criação da Página de Dashboard:**\n   - Gere uma nova página customizada do Filament. Esta será um componente Livewire.\n   ```bash\n   vendor/bin/sail artisan make:filament-page Dashboard\n   ```\n   - Configure esta página para ser a URL raiz do painel administrativo no `AdminPanelProvider`.\n\n3. **Lógica do Componente (`app/Filament/Pages/Dashboard.php`):**\n   - No método `mount()` da classe `Dashboard`, obtenha o usuário autenticado e carregue suas relações de `credential` e `rank`, conforme estabelecido nas Tasks #12 e #10.\n   ```php\n   public \\App\\Models\\User $user;\n\n   public function mount(): void\n   {\n       $this->user = auth()->user()->load(['credential', 'rank']);\n   }\n   ```\n\n4. **Desenvolvimento da View (`resources/views/filament/pages/dashboard.blade.php`):**\n   - Utilize a sintaxe do Blade para construir o layout.\n   - Verifique se o usuário possui uma credencial com `@if ($this->user->credential)`.\n   - Se não houver credencial, exiba uma mensagem informativa, como 'Nenhuma credencial de segurança ativa encontrada para este usuário.'.\n   - Se houver, crie um card com Tailwind CSS (`<div class=\"p-6 bg-white dark:bg-gray-800 rounded-xl shadow-md\">`).\n   - Exiba os dados do usuário e da credencial:\n     - **Posto/Graduação e Nome:** `$this->user->rank->name` e `$this->user->name`.\n     - **Número da Credencial:** `$this->user->credential->credential_number`.\n     - **Datas:** Formate as datas `concession_date` e `expiration_date` para `d/m/Y`.\n     - **Grau de Sigilo e Status:** Implemente badges coloridos. Exemplo para sigilo:\n       ```html\n       @switch($this->user->credential->secrecy)\n           @case('Reservado')\n               <span class=\"... bg-blue-100 text-blue-800 ...\">Reservado</span>\n               @break\n           @case('Secreto')\n               <span class=\"... bg-red-100 text-red-800 ...\">Secreto</span>\n               @break\n           @default\n               <span class=\"... bg-gray-100 text-gray-800 ...\">Não Classificado</span>\n       @endswitch\n       ```\n   - Utilize ícones do pacote `blade-heroicons` para melhorar a interface visual (ex: `identification`, `calendar`, `shield-check`).\n   - Garanta que o layout do card seja responsivo usando as classes utilitárias do Tailwind (ex: `grid`, `grid-cols-1`, `md:grid-cols-2`).",
        "testStrategy": "A estratégia de teste deve validar tanto a interface quanto a lógica de apresentação dos dados.\n\n1. **Verificação da Sidebar:**\n   - Após o login, confirme que o item de menu 'Painel de Controle' foi renomeado para 'Dashboard' e que clicar nele leva para a nova página.\n\n2. **Teste com Usuário com Credencial:**\n   - Faça login com um usuário que tenha uma credencial ativa e um posto/graduação associado.\n   - Verifique se a página do dashboard é exibida por padrão.\n   - Confirme que o card de credencial é renderizado e exibe corretamente todos os dados: posto/graduação, nome completo, número da credencial, data de concessão, data de validade e grau de sigilo.\n   - Verifique se os badges de 'secrecy' e 'status' (se implementado) possuem as cores e textos corretos de acordo com os valores no banco de dados.\n\n3. **Teste com Usuário sem Credencial:**\n   - Faça login com um usuário que não possui uma credencial associada.\n   - Verifique se o dashboard exibe a mensagem 'Nenhuma credencial de segurança ativa encontrada' ou similar.\n   - Confirme que o card com os detalhes da credencial não é renderizado.\n\n4. **Teste de Responsividade:**\n   - Utilize as ferramentas de desenvolvedor do navegador para simular diferentes tamanhos de tela (mobile, tablet, desktop).\n   - Verifique se o layout do card e da página se ajusta de forma limpa, sem quebras ou sobreposição de conteúdo.",
        "status": "done",
        "dependencies": [
          "10",
          "12"
        ],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "Gerar Página de Dashboard e Configurar Rota Principal no Filament",
            "description": "Criar a nova página 'Dashboard' usando o comando artisan e configurá-la como a página inicial do painel administrativo, além de renomear o item de menu na sidebar.",
            "dependencies": [],
            "details": "Execute `php artisan make:filament-page Dashboard`. Em `app/Providers/Filament/AdminPanelProvider.php`, defina `->path('/')` e adicione `Pages\\Dashboard::class` às `pages`. Renomeie o item de navegação de 'Painel de Controle' para 'Dashboard'.",
            "status": "done",
            "testStrategy": "Após login, verificar se a URL padrão é `/admin`, se a nova página de dashboard carrega e se o menu lateral exibe 'Dashboard' corretamente.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:07:38.829Z"
          },
          {
            "id": 2,
            "title": "Implementar Lógica de Carregamento de Dados no Componente Dashboard",
            "description": "No método `mount` da classe `Dashboard.php`, obter o usuário autenticado e carregar de forma otimizada suas relações `credential` e `rank` para serem usadas na view.",
            "dependencies": [
              1
            ],
            "details": "Na classe `app/Filament/Pages/Dashboard.php`, adicione uma propriedade pública `public \\App\\Models\\User $user;`. No método `mount()`, atribua a ela o resultado de `auth()->user()->load(['credential', 'rank'])`.",
            "status": "done",
            "testStrategy": "Utilizar `dd($this->user)` no método `mount` para depurar e confirmar que o objeto do usuário, junto com os dados das relações `credential` e `rank`, está sendo carregado corretamente na inicialização da página.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:07:53.983Z"
          },
          {
            "id": 3,
            "title": "Desenvolver a View do Card de Credencial com Lógica Condicional",
            "description": "Criar o layout na view `dashboard.blade.php` para exibir os dados da credencial. O componente deve tratar o caso em que o usuário não possui uma credencial, exibindo uma mensagem informativa.",
            "dependencies": [
              2
            ],
            "details": "No arquivo `resources/views/filament/pages/dashboard.blade.php`, utilize a diretiva `@if ($this->user->credential)` para renderizar o card. Caso contrário, exiba um parágrafo com a mensagem 'Nenhuma credencial de segurança ativa encontrada para este usuário.'.",
            "status": "done",
            "testStrategy": "Acessar o dashboard com um usuário que possui credencial e com um que não possui. Verificar se o card é exibido para o primeiro e a mensagem informativa para o segundo. Validar a exibição dos dados básicos (nome, número da credencial, datas). ",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:08:35.128Z"
          },
          {
            "id": 4,
            "title": "Estilizar o Card com Tailwind CSS, Ícones e Garantir Responsividade",
            "description": "Aplicar estilos visuais ao card usando Tailwind CSS, incluindo badges coloridos para status e grau de sigilo, adicionar ícones do pacote `blade-heroicons` e garantir que o layout se adapte a diferentes tamanhos de tela.",
            "dependencies": [
              3
            ],
            "details": "Utilize classes como `p-6`, `bg-white`, `dark:bg-gray-800`, `rounded-xl` e `shadow-md`. Implemente a lógica `@switch` para badges coloridos. Adicione ícones (`identification`, `calendar`) e use `grid`, `grid-cols-1`, `md:grid-cols-2` para responsividade.",
            "status": "done",
            "testStrategy": "Inspecionar visualmente o card em diferentes resoluções (desktop e mobile) para confirmar a responsividade do layout. Verificar se as cores dos badges para grau de sigilo estão corretas e se as datas estão formatadas como `d/m/Y`.",
            "parentId": "undefined",
            "updatedAt": "2025-11-21T06:09:12.448Z"
          }
        ],
        "complexity": 4,
        "recommendedSubtasks": 4,
        "expansionPrompt": "Dividir em: (1) Gerar a página Filament 'Dashboard' e configurá-la como a página inicial no AdminPanelProvider; (2) Implementar a lógica no método `mount` para carregar o usuário autenticado com suas relações `credential` e `rank`; (3) Desenvolver a view Blade, criando o card para exibir os dados da credencial e tratando o caso em que a credencial não existe; (4) Estilizar o card com Tailwind CSS, adicionar ícones e garantir a responsividade do layout.",
        "updatedAt": "2025-11-21T06:09:12.448Z"
      },
      {
        "id": "14",
        "title": "Atualização do Tailwind CSS para a Última Versão v3.4.x",
        "description": "Atualizar o Tailwind CSS da v3.1.0 para a versão estável mais recente do v3 (atualmente 3.4.x), garantindo a compatibilidade com a stack existente (Filament 4, Laravel 12) e ajustando as configurações conforme necessário.",
        "details": "O objetivo é modernizar a stack de frontend, aproveitando as melhorias de performance e os novos recursos das versões mais recentes do Tailwind CSS v3, mantendo a estabilidade visual da aplicação.\n\n1. **Atualizar Dependências via NPM**:\n   - No arquivo `package.json`, atualize as `devDependencies` relacionadas ao Tailwind. Execute o comando:\n   ```bash\n   npm install -D tailwindcss@^3.4 postcss@^8 autoprefixer@^10\n   ```\n   Isso instalará a versão estável mais recente do Tailwind CSS v3 e suas dependências diretas.\n\n2. **Revisar as Notas de Lançamento**:\n   - Consulte o blog oficial do Tailwind CSS para revisar as mudanças significativas entre a v3.1 e a v3.4. Preste atenção a classes depreciadas ou mudanças em chaves de configuração, embora a v3 seja majoritariamente retrocompatível.\n\n3. **Verificar Configuração `tailwind.config.js`**:\n   - Garanta que a chave `content` no arquivo `tailwind.config.js` está corretamente configurada para escanear os arquivos do Filament 4, além dos arquivos do projeto. A configuração deve incluir caminhos como:\n   ```javascript\n   content: [\n       './app/Filament/**/*.php',\n       './resources/views/filament/**/*.blade.php',\n       './vendor/filament/**/*.blade.php',\n       './vendor/awcodes/filament-badgeable-column/resources/views/**/*.blade.php' // Se houver plugins\n   ]\n   ```\n\n4. **Compilar os Ativos**:\n   - Execute o comando de compilação para gerar o novo arquivo `app.css` com a versão atualizada do Tailwind.\n   ```bash\n   npm run dev\n   ```\n   - Verifique o console por quaisquer avisos de depreciação emitidos pelo Tailwind e corrija-os no código-fonte.\n\n5. **Verificação Visual Completa**:\n   - Após a compilação, navegue por todas as páginas e componentes da aplicação para identificar qualquer regressão visual ou quebra de layout.",
        "testStrategy": "A estratégia de teste deve focar na verificação de regressões visuais em toda a aplicação, especialmente nos componentes recentemente desenvolvidos.\n\n1. **Teste de Compilação**:\n   - Confirme que os comandos `npm run dev` e `npm run build` são executados com sucesso, sem erros ou avisos críticos.\n\n2. **Teste de Regressão Visual no Dashboard (Task #13)**:\n   - Acesse o Dashboard e verifique se o card de credencial do usuário mantém seu layout, espaçamento, cores e tipografia originais.\n\n3. **Teste de Regressão no CRUD de Credenciais (Task #12)**:\n   - Acesse o `CredentialResource`.\n   - **Listagem**: Verifique a tabela, alinhamento de colunas, e a cor dos badges de sigilo (`secrecy`).\n   - **Formulário**: Abra as modais de criação e edição. Verifique o estilo de todos os campos (`TextInput`, `Select`, `DatePicker`), labels e mensagens de erro de validação.\n\n4. **Teste de Componentes Reutilizáveis (Task #4)**:\n   - Verifique as tabelas de Usuários e Credenciais para confirmar que os badges renderizados com o Enum `BadgeColor` ainda exibem as cores corretas (`success`, `warning`, `danger`, etc.).\n\n5. **Teste de Layout Geral e Responsividade**:\n   - Verifique o layout principal do Filament (sidebar, painel superior, menu do usuário) em diferentes resoluções de tela (desktop, tablet e mobile) para garantir que as classes responsivas do Tailwind continuam funcionando como esperado.",
        "status": "done",
        "dependencies": [
          "12",
          "13"
        ],
        "priority": "medium",
        "subtasks": [],
        "updatedAt": "2025-11-22T19:45:53.585Z"
      },
      {
        "id": "15",
        "title": "Criação de Tema Personalizado para Filament 4 (Padrão Aeronáutica)",
        "description": "Desenvolver e aplicar um tema customizado para o painel Filament 4, alinhando a identidade visual da aplicação com os padrões da Aeronáutica, incluindo paleta de cores, tipografia e estilos de componentes.",
        "details": "O objetivo é substituir o tema padrão do Filament por um tema personalizado que reflita a identidade visual da Aeronáutica. Isso será feito utilizando o sistema de temas do Filament, que se baseia em Tailwind CSS.\n\n1. **Publicar Arquivos de Tema:**\n   - Utilize o comando do Artisan para criar os arquivos de tema. Isso gerará um arquivo CSS e um arquivo de configuração Tailwind específico para o tema.\n   ```bash\n   php artisan filament:theme\n   ```\n   - Este comando criará o arquivo `resources/css/filament/admin/theme.css`.\n\n2. **Configurar a Paleta de Cores em `tailwind.config.js`:**\n   - Edite o arquivo `tailwind.config.js` para estender as cores do Filament com a paleta da Aeronáutica. As cores devem ser definidas para 'primary', 'success', 'warning', 'danger' e 'gray'.\n   ```javascript\n   // tailwind.config.js\n   import preset from './vendor/filament/filament/tailwind.config.preset'\n\n   export default {\n       presets: [preset],\n       content: [\n           './app/Filament/**/*.php',\n           './resources/views/filament/**/*.blade.php',\n           './vendor/filament/**/*.blade.php',\n       ],\n       theme: {\n           extend: {\n               colors: {\n                   // Exemplo de paleta 'Azul Aeronáutica'\n                   primary: {\n                       50: '#eef6ff',\n                       100: '#d9eaff',\n                       200: '#badcff',\n                       300: '#8cc5ff',\n                       400: '#5aa8ff',\n                       500: '#368eff',\n                       600: '#1b74ff',\n                       700: '#0a63f5',\n                       800: '#0c52c9',\n                       900: '#10469e',\n                       950: '#0d2a63',\n                   },\n                   // Definir outras cores semânticas (danger, success, etc.) se necessário\n               }\n           }\n       }\n   }\n   ```\n\n3. **Registrar o Tema no Painel de Administração:**\n   - No arquivo `app/Providers/Filament/AdminPanelProvider.php`, registre o tema compilado.\n   ```php\n   // app/Providers/Filament/AdminPanelProvider.php\n   use Filament\\Panel;\n   use Filament\\PanelProvider;\n   use Illuminate\\Support\\Facades\\Vite;\n\n   class AdminPanelProvider extends PanelProvider\n   {\n       public function panel(Panel $panel): Panel\n       {\n           return $panel\n               // ... outras configurações\n               ->viteTheme('resources/css/filament/admin/theme.css');\n       }\n   }\n   ```\n\n4. **Configurar Tipografia:**\n   - Para usar uma fonte customizada (ex: 'Roboto', 'Inter'), adicione-a ao seu layout principal ou importe-a no CSS. Em seguida, configure-a no `tailwind.config.js`.\n   - Exemplo de importação em `resources/css/filament/admin/theme.css`:\n     `@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');`\n\n5. **Compilar os Ativos:**\n   - Após as alterações, compile os arquivos CSS para que as mudanças do tema sejam aplicadas.\n   ```bash\n   npm run build\n   ```",
        "testStrategy": "A estratégia de teste deve ser focada na validação visual e na consistência da interface.\n\n1. **Verificação de Compilação:**\n   - Execute `npm run build` e confirme que o processo termina sem erros.\n\n2. **Validação da Paleta de Cores:**\n   - Navegue pela aplicação e verifique se a cor 'primary' customizada está sendo aplicada em botões principais, links, anéis de foco de inputs e outros elementos interativos.\n   - Acesse uma listagem que utilize badges (como a de credenciais ou usuários) e valide se as cores semânticas (sucesso, perigo, aviso), conforme definidas no `BadgeColor` Enum da Task #4, estão renderizando com os novos tons do tema (ou com os padrões do Filament caso não tenham sido sobrescritas).\n\n3. **Validação da Tipografia:**\n   - Inspecione o texto em diferentes partes da interface (títulos, parágrafos, labels de formulário) para confirmar que a fonte customizada está sendo aplicada corretamente.\n\n4. **Teste de Componentes Visuais:**\n   - Verifique a aparência de todos os componentes padrão do Filament: tabelas, formulários, modais, notificações, e a página de login.\n   - Acesse o dashboard customizado criado na Task #13 e confirme que o Card de Credencial e outros widgets estão visualmente harmoniosos com o novo tema.\n\n5. **Teste de Responsividade e Cross-browser:**\n   - Verifique a aplicação em diferentes tamanhos de tela (desktop, tablet, mobile) para garantir que o tema não quebrou o layout responsivo.\n   - Teste a aparência em navegadores modernos como Chrome, Firefox e Safari.",
        "status": "done",
        "dependencies": [
          "14",
          "13",
          "4"
        ],
        "priority": "medium",
        "subtasks": [],
        "updatedAt": "2025-11-22T19:49:43.732Z"
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2025-11-23T04:23:08.056Z",
      "taskCount": 15,
      "completedCount": 12,
      "tags": [
        "master"
      ]
    }
  }
}